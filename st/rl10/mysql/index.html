<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>Database Manager for MySQL for Chef Server (RightLink 10)</title><meta content="The RightLink 10 Database Manager for MySQL for Chef Server ServerTemplate installs and configures a MySQL database server." name="description" /><meta content="initial-scale=1" name="viewport" /><link href="https://my.rightscale.com/favicon.ico" rel="icon" /><!--Stylesheets--><link href="../../../css/main.css" rel="stylesheet" /><!--JavaScript--><script src="../../../js/main.js"></script></head><body class="st st_rl10 st_rl10_mysql st_rl10_mysql_index" data-spy="scroll" data-target="#subnav-right"><nav class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container-fluid max-width"><div class="navbar-header"><button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="../../../img/FX_Logo_pos.png" /></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a target="_blank" href="https://community.flexera.com/t5/Flexera-Community/ct-p/Flexera_Community">Community</a></li><li><a target="_blank" href="https://www.flexera.com/blog/">Blog</a></li><li><a target="_blank" href="https://www.flexera.com/about-us/contact-us.html">Contact</a></li><li><a target="_blank" href="https://login.rightscale.com/login/session/new">Log In</a></li></ul><ul class="nav navbar-nav navbar-right nav-status"><li class="nav-al-search"><a href="../../../search.html">Search</a></li></ul><form class="navbar-form navbar-left" role="search" action="/search.html" method="get" ><div class="form-group"><input class="form-control input-sm" id="site-search" placeholder="Search" type="text" name="q" /></div><input type="submit" style="position: absolute; left: -9999px"/></form><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript"> docsearch({apiKey: 'b58c3ad6ab9d6e3cd425867d64a6766f',indexName: 'rightscale',inputSelector: '#site-search', debug: false, autocompleteOptions: {autoselect: false}});</script></div></div></nav><div class="wrap"><div class="container-fluid max-width"><div class="row"><div class="col-sm-3"><div class="clearfix"><aside class="main-nav" role="complementary"><nav class="list-group" role="navigations"><a class="list-group-item" href="/st"><h4 class="list-group-heading"><img src="../../../img/product-cloud-management.svg" /><span>ServerTemplates</span></h4></a><a class="list-group-item" href="../../about.html">About</a><a class="list-group-item" href="/st/rl10">Version RL10</a><a class="list-group-item" href="../../open-source/">Open Source</a></nav></aside><div class="callout"><a href="/api/"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../img/icon-api.svg" /><h4>Flexera CMP APIs</h4></div><span>See the API reference documentation for all of our products.</span></div></div></a></div><div class="callout"><a href="../../../ca/cloud_comp/ca_getting_started_with_cloud_comparison.html"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../img/icon-cloud-blue.svg" /><h4>Cloud Comparison</h4></div><span>Compare public clouds based on the features they offer.</span></div></div></a></div><div class="callout"><a target="_blank" href="http://feedback.rightscale.com"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../img/icon-feedback.svg" /><h4>Feedback</h4></div><span>Get in touch and we’ll get back to you as soon as we can.</span></div></div></a></div><div class="callout"><a href="/release-notes"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../img/icon-notes.svg" /><h4>Release Notes</h4></div><span>See the notes for the latest releases of each application and what’s changed.</span></div></div></a></div></div></div><div class="col-sm-9"><div class="row"><div class="col-sm-9"><div class="clearfix"><p><a href="../../../">Flexera CMP Docs</a> &#x2F; <a href="../../">ServerTemplates</a> &#x2F; <a href="../">Version RightLink 10 ServerTemplates</a></p><div class="page-header"><h1>Database Manager for MySQL for Chef Server (RightLink 10)</h1></div><div class="main-content"><h2 id="overview">Overview</h2>

<p>The Database Manager for MySQL for Chef Server (RightLink 10) ServerTemplate installs and configures a MySQL database server. This ServerTemplate provides a high-availability master/slave database configuration that you can use as the backbone for a variety of applications and workloads.
The Database Manager for MySQL Chef Server ServerTemplate creates and attaches cloud based volumes used to store database data. These volumes are periodically backed up based on the volume snapshot features provided by the cloud.</p>

<div class="alert alert-info" role="alert"><strong>Note:</strong><p>This ServerTemplate requires a Chef Server with the required cookbooks (see below under Requirements) uploaded to the Chef Server to work.</p>
</div>

<div class="alert alert-info" role="alert"><strong>Note:</strong><p>For a complete list of the Database Manager for MySQL ServerTemplate&#39;s features and support, view the detailed description under its Info tab.</p>
</div>

<h2 id="requirements">Requirements</h2>

<ul>
<li><a href="/st/rl10/chef-server/index.html">Chef Server</a> or Hosted Chef</li>
<li><a href="https://github.com/rightscale-cookbooks/rs-mysql/blob/v2.0.2/metadata.rb#L13-#L28">rs-mysql</a></li>
<li>Instance size should include at least 1gb memory.<br></li>
</ul>

<h2 id="software-application-versions">Software Application Versions</h2>

<ul>
<li><a href="https://github.com/rightscale-cookbooks/rs-mysql/blob/v2.0.2/README.md#requirements">MySQL Versions</a></li>
</ul>

<h2 id="technical-overview">Technical Overview</h2>

<p>The Database Manager for MySQL 5 ServerTemplate consists of scripts in all three sections - Boot Sequence, Operational Scripts, and Decommission Sequence.</p>

<h3 id="technical-overview-boot-sequence">Boot Sequence</h3>

<p>See <a href="/st/rl10/base_linux/overview.html">RightLink 10 Linux Base </a> for details on the default scripts.</p>

<ul>
<li><strong>Chef Client Install</strong> - This script installs and configures the chef client.<br></li>
<li><strong>MySQL Server Install</strong> -  Installs the MySQL server and tunes the attributes used in the my.cnf based on the available system memory and the server usage type. If the server usage type is &#39;dedicated&#39;, all resources in the system are dedicated to the MySQL server and if the usage type is &#39;shared&#39;, only half of the resources are used for the MySQL server. This &#39;shared&#39; usage will be used in building a LAMP stack where the same system is used to run both the MySQL server and the PHP application server. This recipe also installs the collectd plugins for MySQL and tags the server as a standalone MySQL server.</li>
</ul>

<h3 id="technical-overview-operational-scripts">Operational Scripts</h3>

<ul>
<li><strong>MySQL Server Install - chef</strong> - See description above in Boot Sequence.</li>
<li><strong>MySQL Server Volume - chef</strong> - Creates a new volume from scratch or from an existing backup based on the value provided in the <code>RESTORE_LINEAGE</code> Input. If this Input is set, the volume will be restored from a backup matching this lineage otherwise a new volume will be created from scratch. This recipe will also format the volume using the filesystem specified in <code>DEVICE_FILESYSTEM</code> Input, mount the volume on the location specified in DEVICE_MOUNT_POINT input, and move the MySQL database directory to the volume.</li>
<li><strong>MySQL Server Stripe - chef</strong> - Creates a logical volume composed of volumes that are created from scratch or from an existing backup based on the value provided in <code>RESTORE_LINEAGE</code> Input. If this input is set, the volumes will be restored from a backup matching this lineage otherwise volumes comprising the logical volume will be created from scratch. This recipe will create a striped logical volume using LVM on the volumes and format the logical volume using the filesystem specified in <code>DEVICE_FILESYSTEM</code> Input. This recipe also mounts the volume on the location specified in DEVICE_MOUNT_POINT Input and moves the MySQL database directory to the logical volume.</li>
<li><strong>MySQL Server Master - chef</strong> - This recipe sets up the database to act as the master. It makes sure the database is not read-only by overriding the mysql/tunable/read_only to false and includes the rs-mysql::default recipe which installs MySQL and performs the configuration. The master database specific tags are added to the server and the master is reset.  The master database can be provided with a fully qualified domain name (FQDN) by setting the <code>DNS_MASTER_FQDN</code> input. The DNS provider credentials (<code>DNS_USER_KEY</code> and <code>DNS_SECRET_KEY</code>) must also be set to create/update the DNS records in the DNS provider.  The default DNS provider is DNS Made Easy API 2.0.<br></li>
<li><strong>MySQL Server Slave - chef</strong> - This recipe modifies the MySQL server to be read-only and includes the rs-mysql::default recipe which installs MySQL, performs configuration, and tags the server as a slave server. It obtains the information about the master database with the help of the find_database_servers helper method provided by the rightscale_tag cookbook and changes the master host of the slave to the latest master available in the deployment. If this script is run after <code>MySQL Server Volume - chef</code> or <code>MySQL Server Stripe - chef</code> and a backup was restored, this recipe will use information from the backup to assist with catching up with the master MySQL database.</li>
<li><strong>MySQL Server Backup - chef</strong> - Takes a backup of all volumes attached to the server (except boot disks if there were any) with the lineage specified in the <code>BACKUP_LINEAGE</code> input. During the backup process, the MySQL database will be read-only and the filesystem will be frozen. With the help of a chef exception handler, the filesystem will be unfrozen and the MySQL database will no longer be read-only after the backup even if the backup process fails . This recipe also cleans up the volume snapshots based on the criteria specified in the <code>BACKUP_KEEP_*</code> inputs.</li>
<li><strong>MySQL Server Schedule - chef</strong> - Adds/removes the crontab entry for taking backups periodically at the minute and hour provided via the <code>SCHEDULE_MINUTE</code> and <code>SCHEDULE_HOUR</code> inputs.</li>
</ul>

<h3 id="technical-overview-decommission-sequence-">Decommission Sequence:</h3>

<ul>
<li><strong>MySQL Server Schedule - chef</strong> - If the <code>DEVICE_DESTROY_ON_DECOMMISSION</code> Input is set to true, this script moves the MySQL database back to the root volume, drops the database specified by <code>APPLICATION_DATABASE_NAME</code> if it is specified, and detaches and deletes the volumes attached to the server. This operation will be skipped if the server is entering the stop state or rebooting.</li>
</ul>

<h2 id="volume-management">Volume Management</h2>

<p>The Database Manager for MySQL 5 ServerTemplate contains recipes to manage cloud volumes. These volumes are used by the database for its data storage location. The cloud&#39;s snapshot feature is used to do backups and restores. However, if the cloud does not support volumes, backups will not be possible.</p>

<p>The <code>MySQL Server Volume - chef</code> script creates a single volume of the size provided by the ‘Device Volume Size’ input, attaches, and formats the volume. The rs-mysql::stripe script creates multiple volumes, attaches them, uses them to create a logical volume, and formats.
The size of the volumes created and attached when using rs-mysql::stripe is determined by the ‘Device Volume Size’ and ‘Device Count’ inputs using this formula: <code>(total_size.to_f / device_count.to_f).ceil</code></p>

<h2 id="backup-and-restore">Backup and Restore</h2>

<p>Backups are performed using the rs-mysql::backup script.  It signals the cloud to create a snapshot of all volumes attached to the server (with the exception of root disks if applicable) with the lineage specified in the &#39;Backup Lineage&#39; input. During the backup process, the MySQL database will be read-only and the filesystem will be frozen. Due to the freezing of the database and filesystem, it is recommended that backups are done on &#39;slave&#39; databases. Once the backup process is complete, regardless of returning a success or failure, the filesystem and database will be unfrozen. The completion of the backup process is is determined by cloud.
Restoring a database, which means restoring volumes, is done using <code>MySQL Server Volume - chef</code> or <code>MySQL Server Stripe - chef</code> with the <code>RESTORE_LINEAGE</code> input set. The optional ‘Restore Timestamp’ input can also be set if there is a specific timestamp that needs to be restored.</p>

<h2 id="continuous-backup">Continuous Backup</h2>

<p>The <strong>MySQL Server Schedule - chef</strong> script is used to configure continuous backups at specified times.  Please review the script details above.</p>

<h2 id="mysql-tuning-parameters">MySQL Tuning Parameters</h2>

<p>The most common customization of a MySQL database server is tuning the MySQL parameters to be more optimized for your own database. The Database Manager for MySQL 5.1/5.5 ServerTemplate performs automatic tuning based on available system memory and the server usage type. As you become more familiar with the performance characteristics of your database, you may want to modify some of these parameters accordingly.</p>

<p><strong>Default MySQL turning parameters:</strong></p>

<p><a href="https://github.com/rightscale-cookbooks/rs-mysql/blob/master/libraries/tuning.rb">https://github.com/rightscale-cookbooks/rs-mysql/blob/master/libraries/tuning.rb</a></p>

<p>To learn how to override the default settings see <a href="http://support.rightscale.com/12-Guides/Chef_Cookbooks_Developer_Guide/04-Developer/ServerTemplate_Development/02-Customize_a_Chef-based_ServerTemplate/index.html">Customize a Chef-Based ServerTemplate</a>.</p>

<h2 id="further-reading">Further Reading</h2>

<ul>
<li><a href="/st/rl10/mysql/tutorial.html">Database Manager for MySQL 5.1/5.5 - Tutorial</a></li>
</ul>
</div></div></div><div class="col-sm-3 hidden-xs affix-parent"><div class="clearfix" data-clampedwidth=".affix-parent" data-offset-bottom="200" data-offset-top="4" data-spy="affix"><nav class="subnav-right" id="subnav-right" role="sub-nav"><script>createRightHandNav();</script></nav></div></div></div></div></div></div></div><footer class="main-footer" role="contentinfo"><div class="container-fluid max-width"><div class="row"><div class="col-sm-10"><ul class="list-inline"><li><small>&copy; 2024 Flexera</small></li><li><a href="http://www.flexera.com/" target="_blank"><small>Flexera Home</small></a></li><li><a href="https://www.flexera.com/about-us/careers.html" target="_blank"><small>We're Hiring</small></a></li></ul></div></div></div></footer><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-KB9SMN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-KB9SMN');</script><script type="text/javascript">
  // Add clipboard button trigger
  var snippets = document.querySelectorAll('.syntax-highlight');
  [].forEach.call(snippets, function(snippet) {
  snippet.firstChild.insertAdjacentHTML('beforebegin', '<button class="btn snippet-clipboard" data-clipboard-snippet><img src="/img/icon-clipboard.svg"></button>');
  });

  // clipboard trigger
  var clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
  target: function(trigger) {
  return trigger.nextElementSibling;
  }
  });

  // Tooltip trigger
  clipboardSnippets.on('success', function(e) {
  e.clearSelection();
  showTooltip(e.trigger, 'Copied!');
  });

  // Error message
  clipboardSnippets.on('error', function(e) {
  showTooltip(e.trigger, fallbackMessage(e.action));
  });

  // Tooltip events
  var btns = document.querySelectorAll('.syntax-highlight .btn');
  for (var i = 0; i < btns.length; i++) {
  btns[i].addEventListener('mouseleave', clearTooltip);
  btns[i].addEventListener('blur', clearTooltip);
  }

  function clearTooltip(e) {
  e.currentTarget.setAttribute('class', 'btn');
  e.currentTarget.removeAttribute('aria-label');
  }

  function showTooltip(elem, msg) {
  elem.setAttribute('class', 'btn tooltipped tooltipped-s');
  elem.setAttribute('aria-label', msg);
  }
</script></body></html>