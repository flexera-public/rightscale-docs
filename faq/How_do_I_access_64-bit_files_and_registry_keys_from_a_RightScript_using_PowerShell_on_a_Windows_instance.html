<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>How do I access 64-bit files and registry keys from a RightScript using PowerShell on a Windows instance?</title><meta content="Future versions of Windows RightImages will run the RightLink windows service completely under 64-bit processes on 64-bit instances." name="description" /><meta content="initial-scale=1" name="viewport" /><link href="https://my.rightscale.com/favicon.ico" rel="icon" /><!--Stylesheets--><link href="../css/main.css" rel="stylesheet" /><!--JavaScript--><script src="../js/main.js"></script></head><body class="faq faq_How_do_I_access_64-bit_files_and_registry_keys_from_a_RightScript_using_PowerShell_on_a_Windows_instance" data-spy="scroll" data-target="#subnav-right"><nav class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container-fluid max-width"><div class="navbar-header"><button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="../img/FX_Logo_pos.png" /></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a target="_blank" href="https://community.flexera.com/t5/Flexera-Community/ct-p/Flexera_Community">Community</a></li><li><a target="_blank" href="https://www.flexera.com/blog/">Blog</a></li><li><a target="_blank" href="https://www.flexera.com/about-us/contact-us.html">Contact</a></li><li><a target="_blank" href="https://login.rightscale.com/login/session/new">Log In</a></li></ul><ul class="nav navbar-nav navbar-right nav-status"><li class="nav-al-search"><a href="../search.html">Search</a></li></ul><form class="navbar-form navbar-left" role="search" action="/search.html" method="get" ><div class="form-group"><input class="form-control input-sm" id="site-search" placeholder="Search" type="text" name="q" /></div><input type="submit" style="position: absolute; left: -9999px"/></form><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript"> docsearch({apiKey: 'b58c3ad6ab9d6e3cd425867d64a6766f',indexName: 'rightscale',inputSelector: '#site-search', debug: false, autocompleteOptions: {autoselect: false}});</script></div></div></nav><div class="wrap"><div class="container-fluid max-width"><div class="row"><div class="col-sm-3"><div class="clearfix"><aside class="main-nav" role="complementary"><nav class="list-group" role="navigations"><a class="list-group-item" href="/faq/"><h4 class="list-group-heading"><span>Frequently Asked Questions</span></h4></a><a class="list-group-item" href="/faq/">General</a><a class="list-group-item" href="/faq/clouds/aws">AWS</a><a class="list-group-item" href="/faq/clouds/google">Google Cloud Platform</a><a class="list-group-item" href="/faq/clouds/azure">Microsoft Azure</a><a class="list-group-item" href="/faq/clouds/softlayer">SoftLayer</a><a class="list-group-item" href="/faq/clouds/vmware">VMware</a></nav></aside><div class="callout"><a href="/api/"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../img/icon-api.svg" /><h4>Flexera CMP APIs</h4></div><span>See the API reference documentation for all of our products.</span></div></div></a></div><div class="callout"><a href="../ca/cloud_comp/ca_getting_started_with_cloud_comparison.html"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../img/icon-cloud-blue.svg" /><h4>Cloud Comparison</h4></div><span>Compare public clouds based on the features they offer.</span></div></div></a></div><div class="callout"><a target="_blank" href="http://feedback.rightscale.com"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../img/icon-feedback.svg" /><h4>Feedback</h4></div><span>Get in touch and we’ll get back to you as soon as we can.</span></div></div></a></div><div class="callout"><a href="/release-notes"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../img/icon-notes.svg" /><h4>Release Notes</h4></div><span>See the notes for the latest releases of each application and what’s changed.</span></div></div></a></div></div></div><div class="col-sm-9"><div class="row"><div class="col-sm-9"><div class="clearfix"><p><a href="../">Flexera CMP Docs</a> &#x2F; <a href="./">RightScale General FAQs</a></p><div class="page-header"><h1>How do I access 64-bit files and registry keys from a RightScript using PowerShell on a Windows instance?</h1></div><div class="main-content"><p><strong>NOTE</strong>: Future versions of Windows RightImages will run the RightLink windows service completely under 64-bit processes on 64-bit instances. Once these images are released, this article will contain a link to the new images. The work around described in this article only apply to Windows RightImages 5.6 and earlier.</p>

<p>The RightLink windows service, that runs on every Windows instance managed by RightScale, currently runs 32-bit processes under the hood even on 64-bit instances. The PowerShell processes used to run Rightscripts, as a result, are also 32-bit PowerShell processes.&nbsp;</p>

<p>The File System Redirector ( <a nocheck href='https://msdn.microsoft.com/en-us/library/aa384187(v=vs.85).aspx'>https://msdn.microsoft.com/en-us/library/aa384187(v=vs.85).aspx</a> ) and Registry Redirector ( <a nocheck href='https://msdn.microsoft.com/en-us/library/aa384232(v=vs.85).aspx'>https://msdn.microsoft.com/en-us/library/aa384232(v=vs.85).aspx</a> ) provide separate logical views for the registry and filesystem to 32-bit processes making it impossible for 32-bit processes to directly access files and registries settings affected by this redirection.</p>

<p>One of the new features of Powershell 2.0, that comes bundles with every RightLink-enabled instance, is remoting. Every 64-bit machine has two remote end points (64-bit and 32-bit) and the 64-bit end point is the default remote end point on a 64-bit instance.</p>

<p>Using the Invoke-Command cmdlet to send a remote command to the local machine, therefore, sends the remote command to a 64-bit listener allowing us to by pass the File System and Registry redirections. In order to use Invoke-Command, however, windows remote management (WinRM) needs to be enabled and configured on your windows instance. The following is an example of configuring your Window instance to accept remote command from localhost:</p>

<p>Create a RightScript with the following PowerShell Code and run it against your instance:</p>
<pre class="syntax-highlight plaintext"><code># Remove Remote UAC restrictions to allow changes to WinRM configuration
reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f

# Check for existing WinRM listeners
$listener = winrm enumerate winrm/config/listener

# Configure a listener if it does not already exist
if ($listener -eq $null)
{
  winrm create winrm/config/listener?Address=IP:127.0.0.1+Transport=HTTP
}
</code></pre>

<p>Your instance should now be setup to allow remote commands issued from localhost. The following is an example of how you can now use Invoke-Command to access files and registry keys that are affected by the filesystem and registry redirections.</p>

<p>Create a RightScript with the following PowerShell code and run it against your instance:&nbsp;</p>
<pre class="syntax-highlight plaintext"><code># In order to access 64-bit files/registries from a 32-bit powershell process, use invoke-command
# to loop back to the local computer and pass-in your code using a script block. The default WinRM
# remote management listener is 64-bit.
#
# Below are some sample commands that demonstrates access to 64-bit files and registry keys

# This command will walk a registry and output Wow6432Node as part of the registry tree
# The Wow6432Node is normally inaccessible from a 32-bit process

invoke-command -computer 127.0.0.1 -scriptblock {gci 'HKLM:\Software'}

# The following commands list the file count for the system32 and syswow64 folders
# On 32-bit processes these counts would be identical as a result of the file system redirector
# On 64-bit processes they would be different.
# The following command should display different file counts as a result of using invoke-command

invoke-command -computer . -scriptblock {
  $System32FileCount = (gci c:\windows\system32).count
  $Syswow64FileCount = (gci c:\windows\syswow64).count
  Write-Output "The System32 file count is: $System32FileCount"
  Write-Output "The Syswow64 file count is: $Syswow64FileCount"
}
</code></pre>

<p>The output of the above should look similar to the following:&nbsp;</p>
<pre class="syntax-highlight plaintext"><code>********************************************************************************
*RS&gt; RightScript: 'AD: Sample for accessing 64-bit files and registry' ****
18:48:54: Hive: HKEY_LOCAL_MACHINE\Software
18:48:54: SKC VC Name Property PSComputerName
--- -- ---- -------- --------------
699 0 Classes {} 127.0.0.1
6 0 Clients {} 127.0.0.1
1 0 Gemplus {} 127.0.0.1
110 0 Microsoft {} 127.0.0.1
1 0 MozillaPlugins {} 127.0.0.1
2 0 ODBC {} 127.0.0.1
1 0 Policies {} 127.0.0.1
0 1 Program Groups {ConvertedToLinks} 127.0.0.1
1 0 Schlumberger {} 127.0.0.1
0 0 Secure {} 127.0.0.1
11 0 Wow6432Node {} 127.0.0.1
18:48:55: The System32 file count is: 1962
The Syswow64 file count is: 1755
*RS&gt; Duration: 16.20 seconds
18:48:55: Script exit status: 0
18:48:55: Script duration: 12.189
18:48:55: Chef Run complete in 16.205 seconds
*RS&gt; completed: AD: Sample for accessing 64-bit files and registry
</code></pre>

<p>The output above shows the registry key <q>Wow6432Node</q> that is normally in-accessible from a 32-bit Powershell instance. The output above also shows that the number of files in the System32 folder is different from the Syswow64 folder, implying that we are indeed accessing the actual system32 folder and not being redirected.</p>

<p>In summary, use the Invoke-Command cmdlet to issue a remote command to localhost and place your Powershell code inside invoke-command&#39;s script block to access 64-bit files and registry settings that are affected by the redirections.</p>
</div></div></div><div class="col-sm-3 hidden-xs affix-parent"><div class="clearfix" data-clampedwidth=".affix-parent" data-offset-bottom="200" data-offset-top="4" data-spy="affix"><nav class="subnav-right" id="subnav-right" role="sub-nav"><script>createRightHandNav();</script></nav></div></div></div></div></div></div></div><footer class="main-footer" role="contentinfo"><div class="container-fluid max-width"><div class="row"><div class="col-sm-10"><ul class="list-inline"><li><small>&copy; 2024 Flexera</small></li><li><a href="http://www.flexera.com/" target="_blank"><small>Flexera Home</small></a></li><li><a href="https://www.flexera.com/about-us/careers.html" target="_blank"><small>We're Hiring</small></a></li></ul></div></div></div></footer><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-KB9SMN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-KB9SMN');</script><script type="text/javascript">
  // Add clipboard button trigger
  var snippets = document.querySelectorAll('.syntax-highlight');
  [].forEach.call(snippets, function(snippet) {
  snippet.firstChild.insertAdjacentHTML('beforebegin', '<button class="btn snippet-clipboard" data-clipboard-snippet><img src="/img/icon-clipboard.svg"></button>');
  });

  // clipboard trigger
  var clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
  target: function(trigger) {
  return trigger.nextElementSibling;
  }
  });

  // Tooltip trigger
  clipboardSnippets.on('success', function(e) {
  e.clearSelection();
  showTooltip(e.trigger, 'Copied!');
  });

  // Error message
  clipboardSnippets.on('error', function(e) {
  showTooltip(e.trigger, fallbackMessage(e.action));
  });

  // Tooltip events
  var btns = document.querySelectorAll('.syntax-highlight .btn');
  for (var i = 0; i < btns.length; i++) {
  btns[i].addEventListener('mouseleave', clearTooltip);
  btns[i].addEventListener('blur', clearTooltip);
  }

  function clearTooltip(e) {
  e.currentTarget.setAttribute('class', 'btn');
  e.currentTarget.removeAttribute('aria-label');
  }

  function showTooltip(elem, msg) {
  elem.setAttribute('class', 'btn tooltipped tooltipped-s');
  elem.setAttribute('aria-label', msg);
  }
</script></body></html>