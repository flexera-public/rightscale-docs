<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>How do I set up WStunnel?</title><meta content="This page outlines the steps for configuring WStunnel. The RightScale platform supports the use of WStunnel to establish an outbound web-sockets tunnel from your environment back to the RightScale platform. This can be used to allow the RightScale platform access to on-premise cloud systems as well as other on-premise APIs." name="description" /><meta content="initial-scale=1" name="viewport" /><link href="https://my.rightscale.com/favicon.ico" rel="icon" /><!--Stylesheets--><link href="../css/main.css" rel="stylesheet" /><!--JavaScript--><script src="../js/main.js"></script></head><body class="faq faq_wstunnel_setup" data-spy="scroll" data-target="#subnav-right"><nav class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container-fluid max-width"><div class="navbar-header"><button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="../img/FX_Logo_pos.png" /></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a target="_blank" href="https://community.flexera.com/t5/Flexera-Community/ct-p/Flexera_Community">Community</a></li><li><a target="_blank" href="https://www.flexera.com/blog/">Blog</a></li><li><a target="_blank" href="https://www.flexera.com/about-us/contact-us.html">Contact</a></li><li><a target="_blank" href="https://login.rightscale.com/login/session/new">Log In</a></li></ul><ul class="nav navbar-nav navbar-right nav-status"><li class="nav-al-search"><a href="../search.html">Search</a></li></ul><form class="navbar-form navbar-left" role="search" action="/search.html" method="get" ><div class="form-group"><input class="form-control input-sm" id="site-search" placeholder="Search" type="text" name="q" /></div><input type="submit" style="position: absolute; left: -9999px"/></form><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript"> docsearch({apiKey: 'b58c3ad6ab9d6e3cd425867d64a6766f',indexName: 'rightscale',inputSelector: '#site-search', debug: false, autocompleteOptions: {autoselect: false}});</script></div></div></nav><div class="wrap"><div class="container-fluid max-width"><div class="row"><div class="col-sm-3"><div class="clearfix"><aside class="main-nav" role="complementary"><nav class="list-group" role="navigations"><a class="list-group-item" href="/faq/"><h4 class="list-group-heading"><span>Frequently Asked Questions</span></h4></a><a class="list-group-item" href="/faq/">General</a><a class="list-group-item" href="/faq/clouds/aws">AWS</a><a class="list-group-item" href="/faq/clouds/google">Google Cloud Platform</a><a class="list-group-item" href="/faq/clouds/azure">Microsoft Azure</a><a class="list-group-item" href="/faq/clouds/softlayer">SoftLayer</a><a class="list-group-item" href="/faq/clouds/vmware">VMware</a></nav></aside><div class="callout"><a href="/api/"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../img/icon-api.svg" /><h4>Flexera CMP APIs</h4></div><span>See the API reference documentation for all of our products.</span></div></div></a></div><div class="callout"><a href="../ca/cloud_comp/ca_getting_started_with_cloud_comparison.html"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../img/icon-cloud-blue.svg" /><h4>Cloud Comparison</h4></div><span>Compare public clouds based on the features they offer.</span></div></div></a></div><div class="callout"><a target="_blank" href="http://feedback.rightscale.com"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../img/icon-feedback.svg" /><h4>Feedback</h4></div><span>Get in touch and we’ll get back to you as soon as we can.</span></div></div></a></div><div class="callout"><a href="/release-notes"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../img/icon-notes.svg" /><h4>Release Notes</h4></div><span>See the notes for the latest releases of each application and what’s changed.</span></div></div></a></div></div></div><div class="col-sm-9"><div class="row"><div class="col-sm-9"><div class="clearfix"><p><a href="../">Flexera CMP Docs</a> &#x2F; <a href="./">RightScale General FAQs</a></p><div class="page-header"><h1>How do I set up WStunnel?</h1></div><div class="main-content"><h2 id="overview">Overview</h2>

<p>The RightScale platform supports the use of WStunnel to establish an outbound web-sockets tunnel from your environment back to the RightScale platform. This obviates the need to open inbound access to your on-premise services. Instead, only outbound port 443 to the RightScale platform needs to be open from your environment to interface with the on-premise from RightScale.</p>

<h2 id="installing-and-configuring-wstunnel">Installing and Configuring WStunnel</h2>

<p>Identify a server in your environment that has access to the on-premise services to which the RightScale platform needs access as well as has outbound Internet access.
Any linux server with the required access will work.</p>

<p>Go to <a href="https://github.com/rightscale/wstunnel">https://github.com/rightscale/wstunnel</a> and copy the link to the wstunnel .tgz file.
The download link is provided in the README.</p>

<p>Login to the server on which wstunnel will be running and download the wstunnel package to the location of your choice on the server.</p>
<pre class="syntax-highlight plaintext"><code>$ wget https://binaries.rightscale.com/rsbin/wstunnel/1.0/wstunnel-linux-amd64.tgz
</code></pre>

<p>Untar/unzip the file.</p>
<pre class="syntax-highlight plaintext"><code>$ tar zxvf ./wstunnel-linux-amd64.tgz
</code></pre>

<p>Edit the wstunnel/init/wstuncli.default file as follows:</p>

<ul>
<li>Add a REGEXP line that matches your the URL for the on-premise service.

<ul>
<li>For example if your service is at https://192.168.0.2, then the following line will allows access to the service (and any other service on that 192.x.x.x network):
    <code>REGEXP=&#39;https://192..*&#39;</code></li>
</ul></li>
<li>Set the TOKEN to some random value that is at least 16 characters.

<ul>
<li>An md5 sum of a file produces a usable value.</li>
</ul></li>
<li>Change the SERVER line to point at your service IP and port.

<ul>
<li>For example: <code>SERVER=https://192.168.0.2:5000</code></li>
</ul></li>
<li>Set the TUNNEL endpoint as follows:

<ul>
<li>If using wstunnel for <strong>OpenStack</strong>, then use <code>wss://wstunnel10-1.rightscale.com</code></li>
<li>Otherwise, identify the shard for the RightScale account with which you are going to use this wstunnel.

<ul>
<li>This is found by going to your rightscale account and navigate to <strong>Settings</strong> &gt; <strong>Account Settings</strong> &gt; <strong>API Credentials</strong> and noting if the Token Endpoint is us-3.rightscale.com or us-4.rightscale.com.</li>
<li>If us-3 then use <code>wss://wstunnel1-1.rightscale.com</code></li>
<li>If us-4 then use <code>wss://wstunnel10-1.rightscale.com</code></li>
</ul></li>
</ul></li>
</ul>

<p>Copy the default file to /etc/default as follows:</p>
<pre class="syntax-highlight plaintext"><code>$ sudo cp wstunnel/init/wstuncli.default /etc/default/wstuncli
</code></pre>

<p>Copy the wstunnel binary to /usr/local/bin:</p>
<pre class="syntax-highlight plaintext"><code>$ sudo cp wstunnel/wstunnel /usr/local/bin/wstunnel
</code></pre>

<h3 id="installing-and-configuring-wstunnel-creating-and-launching-an-upstart-file-for-ubuntu-systems">Creating and Launching an Upstart File for Ubuntu Systems</h3>

<p>Edit wstunnel/init/wstuncli.conf and change the <q>exec /usr/local/bin/wstunnel</q> line (should be near the bottom of the file) to add <q>-regexp $REGEXP</q> as follows:</p>

<ul>
<li><code>exec /usr/local/bin/wstunnel cli -regexp $REGEXP -token $TOKEN -tunnel $TUNNEL -server $SERVER -logfile /var/log/wstuncli.log</code></li>
</ul>

<p>Copy the configuration file to the /etc/init folder.</p>
<pre class="syntax-highlight plaintext"><code>$ sudo cp wstunnel/init/wstuncli.conf /etc/init/
</code></pre>

<ul>
<li>Start the tunnel:</li>
</ul>
<pre class="syntax-highlight plaintext"><code>$ sudo initctl start wstuncli
</code></pre>

<p>Check /var/log/wstuncli.log for errors.</p>

<ul>
<li>Messages indicating <q>WS Opening</q> and <q>WS Ready</q> and <q>Pinger starting</q> indicate success.</li>
</ul>

<h3 id="installing-and-configuring-wstunnel-creating-and-launching-a-systemd-service-file-for-centos-systems">Creating and Launching a Systemd Service File for CentOS Systems</h3>

<p>Create a file: /etc/systemd/system/wstuncli.service with the following contents:</p>
<pre class="syntax-highlight plaintext"><code>[Unit]
Description=WStunnel start up
After=network.target

[Service]
User=root
EnvironmentFile=/etc/default/wstuncli
ExecStart=/usr/local/bin/wstunnel cli -regexp $REGEXP -token $TOKEN -tunnel $TUNNEL -server $SERVER -logfile /var/log/wstuncli.log

[Install]
WantedBy=multi-user.target
</code></pre>

<p>Start the tunnel:</p>
<pre class="syntax-highlight plaintext"><code>$ sudo systemctl start wstuncli.service
</code></pre>

<p>Check /var/log/wstuncli.log for errors</p>

<ul>
<li>Messages indicating <q>WS Opening</q> and <q>WS Ready</q> and <q>Pinger starting</q> indicate success.</li>
</ul>

<p>Enable the tunnel to automatically start on reboots:</p>
<pre class="syntax-highlight plaintext"><code>$ sudo systemctl enable wstuncli.service
</code></pre>

<h2 id="troubleshooting">Troubleshooting</h2>

<ul>
<li><p>If the API endpoint(s) being accessed via the tunnel are using self-signed certificates, add the <code>-insecure</code> parameter to the call to <code>/usr/local/wstunnel</code> in the Upstart or Systemd file. </p></li>
<li><p>Similarly, if using the tunnel returns an X.509 error about <q>IP SANs</q>, use the <code>-insecure</code> option.</p></li>
</ul>
</div></div></div><div class="col-sm-3 hidden-xs affix-parent"><div class="clearfix" data-clampedwidth=".affix-parent" data-offset-bottom="200" data-offset-top="4" data-spy="affix"><nav class="subnav-right" id="subnav-right" role="sub-nav"><script>createRightHandNav();</script></nav></div></div></div></div></div></div></div><footer class="main-footer" role="contentinfo"><div class="container-fluid max-width"><div class="row"><div class="col-sm-10"><ul class="list-inline"><li><small>&copy; 2024 Flexera</small></li><li><a href="http://www.flexera.com/" target="_blank"><small>Flexera Home</small></a></li><li><a href="https://www.flexera.com/about-us/careers.html" target="_blank"><small>We're Hiring</small></a></li></ul></div></div></div></footer><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-KB9SMN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-KB9SMN');</script><script type="text/javascript">
  // Add clipboard button trigger
  var snippets = document.querySelectorAll('.syntax-highlight');
  [].forEach.call(snippets, function(snippet) {
  snippet.firstChild.insertAdjacentHTML('beforebegin', '<button class="btn snippet-clipboard" data-clipboard-snippet><img src="/img/icon-clipboard.svg"></button>');
  });

  // clipboard trigger
  var clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
  target: function(trigger) {
  return trigger.nextElementSibling;
  }
  });

  // Tooltip trigger
  clipboardSnippets.on('success', function(e) {
  e.clearSelection();
  showTooltip(e.trigger, 'Copied!');
  });

  // Error message
  clipboardSnippets.on('error', function(e) {
  showTooltip(e.trigger, fallbackMessage(e.action));
  });

  // Tooltip events
  var btns = document.querySelectorAll('.syntax-highlight .btn');
  for (var i = 0; i < btns.length; i++) {
  btns[i].addEventListener('mouseleave', clearTooltip);
  btns[i].addEventListener('blur', clearTooltip);
  }

  function clearTooltip(e) {
  e.currentTarget.setAttribute('class', 'btn');
  e.currentTarget.removeAttribute('aria-label');
  }

  function showTooltip(elem, msg) {
  elem.setAttribute('class', 'btn tooltipped tooltipped-s');
  elem.setAttribute('aria-label', msg);
  }
</script></body></html>