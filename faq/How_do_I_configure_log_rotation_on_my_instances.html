<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>How do I configure log rotation on my instances?</title><meta content="For auditing or archival purposes, you may need to decrease or increase the log rotation configuration for one or more logs files. To do this, the relevant logrotate configuration file is manipulated or created." name="description" /><meta content="initial-scale=1" name="viewport" /><link href="https://my.rightscale.com/favicon.ico" rel="icon" /><!--Stylesheets--><link href="../css/main.css" rel="stylesheet" /><!--JavaScript--><script src="../js/main.js"></script></head><body class="faq faq_How_do_I_configure_log_rotation_on_my_instances" data-spy="scroll" data-target="#subnav-right"><nav class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container-fluid max-width"><div class="navbar-header"><button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="../img/FX_Logo_pos.png" /></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a target="_blank" href="https://community.flexera.com/t5/Flexera-Community/ct-p/Flexera_Community">Community</a></li><li><a target="_blank" href="https://www.flexera.com/blog/">Blog</a></li><li><a target="_blank" href="https://www.flexera.com/about-us/contact-us.html">Contact</a></li><li><a target="_blank" href="https://login.rightscale.com/login/session/new">Log In</a></li></ul><ul class="nav navbar-nav navbar-right nav-status"><li class="nav-al-search"><a href="../search.html">Search</a></li></ul><form class="navbar-form navbar-left" role="search" action="/search.html" method="get" ><div class="form-group"><input class="form-control input-sm" id="site-search" placeholder="Search" type="text" name="q" /></div><input type="submit" style="position: absolute; left: -9999px"/></form><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript"> docsearch({apiKey: 'b58c3ad6ab9d6e3cd425867d64a6766f',indexName: 'rightscale',inputSelector: '#site-search', debug: false, autocompleteOptions: {autoselect: false}});</script></div></div></nav><div class="wrap"><div class="container-fluid max-width"><div class="row"><div class="col-sm-3"><div class="clearfix"><aside class="main-nav" role="complementary"><nav class="list-group" role="navigations"><a class="list-group-item" href="/faq/"><h4 class="list-group-heading"><span>Frequently Asked Questions</span></h4></a><a class="list-group-item" href="/faq/">General</a><a class="list-group-item" href="/faq/clouds/aws">AWS</a><a class="list-group-item" href="/faq/clouds/google">Google Cloud Platform</a><a class="list-group-item" href="/faq/clouds/azure">Microsoft Azure</a><a class="list-group-item" href="/faq/clouds/softlayer">SoftLayer</a><a class="list-group-item" href="/faq/clouds/vmware">VMware</a></nav></aside><div class="callout"><a href="/api/"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../img/icon-api.svg" /><h4>Flexera CMP APIs</h4></div><span>See the API reference documentation for all of our products.</span></div></div></a></div><div class="callout"><a href="../ca/cloud_comp/ca_getting_started_with_cloud_comparison.html"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../img/icon-cloud-blue.svg" /><h4>Cloud Comparison</h4></div><span>Compare public clouds based on the features they offer.</span></div></div></a></div><div class="callout"><a target="_blank" href="http://feedback.rightscale.com"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../img/icon-feedback.svg" /><h4>Feedback</h4></div><span>Get in touch and we’ll get back to you as soon as we can.</span></div></div></a></div><div class="callout"><a href="/release-notes"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../img/icon-notes.svg" /><h4>Release Notes</h4></div><span>See the notes for the latest releases of each application and what’s changed.</span></div></div></a></div></div></div><div class="col-sm-9"><div class="row"><div class="col-sm-9"><div class="clearfix"><p><a href="../">Flexera CMP Docs</a> &#x2F; <a href="./">RightScale General FAQs</a></p><div class="page-header"><h1>How do I configure log rotation on my instances?</h1></div><div class="main-content"><h2 id="background">Background</h2>

<p>You have need to modify the log rotation configuration for log files (e.g. <code>/var/log/maillog</code>) on an instance to keep a spool of more or less logs.</p>

<h2 id="answer">Answer</h2>

<p>For auditing or archival purposes, you may need to decrease or increase the log rotation configuration for one or more logs files.<br>
To do this, the relevant logrotate configuration file is manipulated or created.</p>

<p>In Linux, the logrotate configuration files are usually found in <code>/etc/logrotate.conf</code> and <code>/etc/logrotate.d</code>.</p>

<h3 id="answer-example-rightscript">Example RightScript</h3>

<p>The RightScale frontend templates are designed to move the Apache and HAProxy logs to the ephemeral storage in <code>/mnt/log</code> via a symlink so that a very large archive of logs can be stored. These typically reside in either <code>/var/log/httpd</code> or <code>/var/log/apache2</code> depending on the Linux distribution.</p>

<p>In the below script, inputs are used to control the frequency of the rotation and the number of rotated log files to keep.<br>
With a daily rotation, rotating 31 files effectively keeps a one month spool of daily logs.</p>
<pre class="syntax-highlight shell"><code><span class="c">#!/bin/bash -e</span>

<span class="c"># RightScript: Modify httpd+haproxy logrotate configuration</span>

<span class="c">#</span>
<span class="c"># Inputs:</span>
<span class="c"># LOGROTATE_HTTPD_ROTATE_FREQ e.g. daily</span>
<span class="c"># LOGROTATE_HTTPD_ROTATE_KEEP e.g. 31</span>
<span class="c">#</span>

<span class="k">if</span> <span class="o">[</span><span class="s2">"</span><span class="nv">$RS_DISTRO</span><span class="s2">"</span> <span class="o">=</span> <span class="s1">'centos'</span><span class="o">]</span>; <span class="k">then
</span>cat <span class="sh">&lt;&lt;EOF&gt; /etc/logrotate.d/httpd
/var/log/httpd/*log {
    $LOGROTATE_HTTPD_ROTATE_FREQ
    rotate $LOGROTATE_HTTPD_ROTATE_KEEP
    missingok
    notifempty
    sharedscripts
    postrotate
        /sbin/service httpd reload &gt; /dev/null 2&gt;/dev/null || true
    endscript
}
EOF
</span><span class="k">fi

if</span> <span class="o">[</span><span class="s2">"</span><span class="nv">$RS_DISTRO</span><span class="s2">"</span> <span class="o">=</span> <span class="s1">'ubuntu'</span><span class="o">]</span>; <span class="k">then
</span>cat <span class="sh">&lt;&lt;EOF&gt; /etc/logrotate.d/apache2
/var/log/apache2/*.log {
        $LOGROTATE_HTTPD_ROTATE_FREQ
        missingok
        rotate $LOGROTATE_HTTPD_ROTATE_KEEP
        compress
        delaycompress
        notifempty
        create 640 root adm
        sharedscripts
        postrotate
                if [-f "`. /etc/apache2/envvars ; echo ${APACHE_PID_FILE:-/var/run/apache2.pid}`"]; then
                            /etc/init.d/apache2 reload &gt; /dev/null
                fi
        endscript
}
EOF
</span><span class="k">fi

</span><span class="nb">echo</span> <span class="s1">'Done.'</span>
</code></pre>

<h3 id="answer-running-logrotate-manually">Running logrotate manually</h3>

<p>In situations such as being alerted to a filling filesystem, you can call logrotate manually to action a rotation early, ahead of cron. This can be done for the entire logrote configuration or a specific include. You can also use the force option which is handy for force-rotating the log file that has been growing and filling up the partition. The verbose (-v) option is used to see the results of the rotation.</p>

<p><strong>Rotating all</strong></p>
<pre class="syntax-highlight plaintext"><code># logrotate -v /etc/logrotate.conf
</code></pre>

<p><strong>Rotating maillog only w/ force</strong></p>
<pre class="syntax-highlight plaintext"><code># logrotate -v --force /etc/logrotate.d/maillog
</code></pre>

<p>This then allows you to move the rotated log(s) to a different volume or off the instance (or optionally delete).</p>

<h2 id="see-also">See also</h2>

<ul>
<li><a href="http://man7.org/linux/man-pages/man8/logrotate.8.html">LOGROTATE(8)</a></li>
</ul>
</div></div></div><div class="col-sm-3 hidden-xs affix-parent"><div class="clearfix" data-clampedwidth=".affix-parent" data-offset-bottom="200" data-offset-top="4" data-spy="affix"><nav class="subnav-right" id="subnav-right" role="sub-nav"><script>createRightHandNav();</script></nav></div></div></div></div></div></div></div><footer class="main-footer" role="contentinfo"><div class="container-fluid max-width"><div class="row"><div class="col-sm-10"><ul class="list-inline"><li><small>&copy; 2024 Flexera</small></li><li><a href="http://www.flexera.com/" target="_blank"><small>Flexera Home</small></a></li><li><a href="https://www.flexera.com/about-us/careers.html" target="_blank"><small>We're Hiring</small></a></li></ul></div></div></div></footer><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-KB9SMN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-KB9SMN');</script><script type="text/javascript">
  // Add clipboard button trigger
  var snippets = document.querySelectorAll('.syntax-highlight');
  [].forEach.call(snippets, function(snippet) {
  snippet.firstChild.insertAdjacentHTML('beforebegin', '<button class="btn snippet-clipboard" data-clipboard-snippet><img src="/img/icon-clipboard.svg"></button>');
  });

  // clipboard trigger
  var clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
  target: function(trigger) {
  return trigger.nextElementSibling;
  }
  });

  // Tooltip trigger
  clipboardSnippets.on('success', function(e) {
  e.clearSelection();
  showTooltip(e.trigger, 'Copied!');
  });

  // Error message
  clipboardSnippets.on('error', function(e) {
  showTooltip(e.trigger, fallbackMessage(e.action));
  });

  // Tooltip events
  var btns = document.querySelectorAll('.syntax-highlight .btn');
  for (var i = 0; i < btns.length; i++) {
  btns[i].addEventListener('mouseleave', clearTooltip);
  btns[i].addEventListener('blur', clearTooltip);
  }

  function clearTooltip(e) {
  e.currentTarget.setAttribute('class', 'btn');
  e.currentTarget.removeAttribute('aria-label');
  }

  function showTooltip(elem, msg) {
  elem.setAttribute('class', 'btn tooltipped tooltipped-s');
  elem.setAttribute('aria-label', msg);
  }
</script></body></html>