<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>Can I use Network Time Protocol (NTP) on my RightScale EC2 servers?</title><meta content="Network Time Protocol (NTP) is a protocol used for synchronizing the time clocks of computers over a network. NTP is used by utilities such as "ntpdate" to accomplish time synchronization across multiple computers." name="description" /><meta content="initial-scale=1" name="viewport" /><link href="https://my.rightscale.com/favicon.ico" rel="icon" /><!--Stylesheets--><link href="../../../css/main.css" rel="stylesheet" /><!--JavaScript--><script src="../../../js/main.js"></script></head><body class="faq faq_clouds faq_clouds_aws faq_clouds_aws_Can_I_use_Network_Time_Protocol_NTP_on_my_RightScale_servers" data-spy="scroll" data-target="#subnav-right"><nav class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container-fluid max-width"><div class="navbar-header"><button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="../../../img/FX_Logo_pos.png" /></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a target="_blank" href="https://community.flexera.com/t5/Flexera-Community/ct-p/Flexera_Community">Community</a></li><li><a target="_blank" href="https://www.flexera.com/blog/">Blog</a></li><li><a target="_blank" href="https://www.flexera.com/about-us/contact-us.html">Contact</a></li><li><a target="_blank" href="https://login.rightscale.com/login/session/new">Log In</a></li></ul><ul class="nav navbar-nav navbar-right nav-status"><li class="nav-al-search"><a href="../../../search.html">Search</a></li></ul><form class="navbar-form navbar-left" role="search" action="/search.html" method="get" ><div class="form-group"><input class="form-control input-sm" id="site-search" placeholder="Search" type="text" name="q" /></div><input type="submit" style="position: absolute; left: -9999px"/></form><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript"> docsearch({apiKey: 'b58c3ad6ab9d6e3cd425867d64a6766f',indexName: 'rightscale',inputSelector: '#site-search', debug: false, autocompleteOptions: {autoselect: false}});</script></div></div></nav><div class="wrap"><div class="container-fluid max-width"><div class="row"><div class="col-sm-3"><div class="clearfix"><aside class="main-nav" role="complementary"><nav class="list-group" role="navigations"><a class="list-group-item" href="/faq/"><h4 class="list-group-heading"><span>Frequently Asked Questions</span></h4></a><a class="list-group-item" href="/faq/">General</a><a class="list-group-item" href="/faq/clouds/aws">AWS</a><a class="list-group-item" href="/faq/clouds/google">Google Cloud Platform</a><a class="list-group-item" href="/faq/clouds/azure">Microsoft Azure</a><a class="list-group-item" href="/faq/clouds/softlayer">SoftLayer</a><a class="list-group-item" href="/faq/clouds/vmware">VMware</a></nav></aside><div class="callout"><a href="/api/"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../img/icon-api.svg" /><h4>Flexera CMP APIs</h4></div><span>See the API reference documentation for all of our products.</span></div></div></a></div><div class="callout"><a href="../../../ca/cloud_comp/ca_getting_started_with_cloud_comparison.html"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../img/icon-cloud-blue.svg" /><h4>Cloud Comparison</h4></div><span>Compare public clouds based on the features they offer.</span></div></div></a></div><div class="callout"><a target="_blank" href="http://feedback.rightscale.com"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../img/icon-feedback.svg" /><h4>Feedback</h4></div><span>Get in touch and we’ll get back to you as soon as we can.</span></div></div></a></div><div class="callout"><a href="/release-notes"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../img/icon-notes.svg" /><h4>Release Notes</h4></div><span>See the notes for the latest releases of each application and what’s changed.</span></div></div></a></div></div></div><div class="col-sm-9"><div class="row"><div class="col-sm-9"><div class="clearfix"><p><a href="../../../">Flexera CMP Docs</a> &#x2F; <a href="../../">RightScale General FAQs</a> &#x2F; <a href="../">Cloud Providers</a> &#x2F; <a href="./">Amazon Web Services</a></p><div class="page-header"><h1>Can I use Network Time Protocol (NTP) on my RightScale EC2 servers?</h1></div><div class="main-content"><h2 id="background">Background</h2>

<p>Network Time Protocol (NTP) is a protocol used for synchronizing the time clocks of computers over a network. NTP is used by utilities such as <q>ntpdate</q> to accomplish time synchronization across multiple computers.</p>

<hr>

<h2 id="answer">Answer</h2>

<p>By default, Amazon has Xen setup on EC2 so that it forces the hardware clock to sync to UTC. However, there may be a (fairly rare) condition that causes the time on your instance to drift. You can fix this on Linux instances by disabling the hypervisor&#39;s independent wallclock then employing the use of an NTP client.</p>

<p><strong>Note</strong>: RightScale RightScripts will set the time zone on your server for you. You have control over that as an Input variable.</p>

<h3 id="answer-enabling-the-independent-wallclock">Enabling the Independent Wallclock</h3>

<p>Issue the following command:</p>
<pre class="syntax-highlight plaintext"><code># echo 1 &gt; /proc/sys/xen/independent_wallclock
</code></pre>

<p>Overriding the value in <code>/proc/sys/xen/independent_wallclock</code> disables sync with the clock on the physical machine (default).</p>

<p><strong>Important!</strong> The drift time will remain after running ntpdate or ntpd until the binary value in independent_wallclock is set to 1.</p>

<h3 id="answer-installing-ntp">Installing NTP</h3>

<p>If you don&#39;t have NTP installed on your instance you must install it first:</p>
<pre class="syntax-highlight plaintext"><code># apt-get -y install ntp || yum -y install ntp
</code></pre>

<h3 id="answer-using-ntpdate">Using ntpdate</h3>

<p>For a once off sync with a remote NTP server, you can use ntpdate, e.g.:</p>
<pre class="syntax-highlight plaintext"><code>root@sandbox:~# ntpdate ntp.nasa.gov time-b.nist.gov
30 Jun 04:05:58 ntpdate[19740]: adjust time server 198.123.30.132 offset -0.001006 sec
</code></pre>

<p>Notice the time adjustment. If a large drift remains after running ntpdate twice, the independent wallclock has not been enabled.</p>

<h3 id="answer-using-ntpd">Using ntpd</h3>

<p>For regular sync with remote NTP servers, use ntpd.</p>
<pre class="syntax-highlight shell"><code><span class="c">#!/bin/bash -ex</span>
<span class="k">if </span>grep <span class="s1">'server ntp.ubuntu.com'</span> /etc/ntp.conf &gt; /dev/null 2&gt;&amp;1; <span class="k">then</span>
   sed -i <span class="s1">'s/server ntp.ubuntu.com/#server ntp.ubuntu.com/g'</span> /etc/ntp.conf
<span class="k">fi
</span>cat <span class="sh">&lt;&lt;EOF&gt;&gt; /etc/ntp.conf
server time.rightscale.com
server pool.ntp.org
EOF
</span></code></pre>
<pre class="syntax-highlight plaintext"><code>service ntp restart || service ntpd restart
</code></pre>

<p>Example service restart showing the initialization of ntpd then a subsequent sync according to the frequency in the configuration:</p>
<pre class="syntax-highlight plaintext"><code>root@sandbox:~# service ntp restart; tail -f /var/log/messages
* Stopping NTP server ntpd [OK]
* Starting NTP server ntpd [OK]
Jun 30 04:11:16 sandbox ntpd[20173]: ntpd 4.2.4p8@1.1612-o Tue Apr 19 07:08:18 UTC 2011 (1)
Jun 30 04:11:16 sandbox ntpd[20174]: precision = 1.000 usec
Jun 30 04:11:16 sandbox ntpd[20174]: Listening on interface #0 wildcard, 0.0.0.0#123 Disabled
Jun 30 04:11:16 sandbox ntpd[20174]: Listening on interface #1 wildcard, ::#123 Disabled
Jun 30 04:11:16 sandbox ntpd[20174]: Listening on interface #2 lo, 127.0.0.1#123 Enabled
Jun 30 04:11:16 sandbox ntpd[20174]: Listening on interface #3 eth0, 10.161.110.239#123 Enabled
Jun 30 04:11:16 sandbox ntpd[20174]: Listening on interface #4 lo, ::1#123 Enabled
Jun 30 04:11:16 sandbox ntpd[20174]: Listening on interface #5 eth0, fe80::1031:3fff:fe01:6d01#123 Enabled
Jun 30 04:11:16 sandbox ntpd[20174]: kernel time sync status 2040
Jun 30 04:11:16 sandbox ntpd[20174]: frequency initialized 17.284 PPM from /var/lib/ntp/ntp.drift
Jun 30 04:15:34 sandbox ntpd[20174]: synchronized to 174.129.253.100, stratum 2
Jun 30 04:15:34 sandbox ntpd[20174]: kernel time sync status change 2001
</code></pre>

<h3 id="answer-see-also">See also</h3>

<ul>
<li><a nocheck href='https://forums.aws.amazon.com/thread.jspa?messageID=53658'>NTP server (AWS forum post)</a></li>
<li><a nocheck href='https://forums.aws.amazon.com/thread.jspa?messageID=278626'>How to get reliable clock time in EC2 (AWS forum post)</a></li>
<li><a href="https://help.ubuntu.com/community/UbuntuTime">UbuntuTime</a></li>
<li><a href="https://www.debian.org/doc/manuals/debian-reference/ch09.en.html#_system_and_hardware_time">System and hardware time</a> (Debian Documentation)</li>
<li><a nocheck href="http://www.tldp.org/HOWTO/TimePrecision-HOWTO/index.html">Managing Accurate Date and Time</a> (HOWTO)</li>
</ul>
</div></div></div><div class="col-sm-3 hidden-xs affix-parent"><div class="clearfix" data-clampedwidth=".affix-parent" data-offset-bottom="200" data-offset-top="4" data-spy="affix"><nav class="subnav-right" id="subnav-right" role="sub-nav"><script>createRightHandNav();</script></nav></div></div></div></div></div></div></div><footer class="main-footer" role="contentinfo"><div class="container-fluid max-width"><div class="row"><div class="col-sm-10"><ul class="list-inline"><li><small>&copy; 2024 Flexera</small></li><li><a href="http://www.flexera.com/" target="_blank"><small>Flexera Home</small></a></li><li><a href="https://www.flexera.com/about-us/careers.html" target="_blank"><small>We're Hiring</small></a></li></ul></div></div></div></footer><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-KB9SMN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-KB9SMN');</script><script type="text/javascript">
  // Add clipboard button trigger
  var snippets = document.querySelectorAll('.syntax-highlight');
  [].forEach.call(snippets, function(snippet) {
  snippet.firstChild.insertAdjacentHTML('beforebegin', '<button class="btn snippet-clipboard" data-clipboard-snippet><img src="/img/icon-clipboard.svg"></button>');
  });

  // clipboard trigger
  var clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
  target: function(trigger) {
  return trigger.nextElementSibling;
  }
  });

  // Tooltip trigger
  clipboardSnippets.on('success', function(e) {
  e.clearSelection();
  showTooltip(e.trigger, 'Copied!');
  });

  // Error message
  clipboardSnippets.on('error', function(e) {
  showTooltip(e.trigger, fallbackMessage(e.action));
  });

  // Tooltip events
  var btns = document.querySelectorAll('.syntax-highlight .btn');
  for (var i = 0; i < btns.length; i++) {
  btns[i].addEventListener('mouseleave', clearTooltip);
  btns[i].addEventListener('blur', clearTooltip);
  }

  function clearTooltip(e) {
  e.currentTarget.setAttribute('class', 'btn');
  e.currentTarget.removeAttribute('aria-label');
  }

  function showTooltip(elem, msg) {
  elem.setAttribute('class', 'btn tooltipped tooltipped-s');
  elem.setAttribute('aria-label', msg);
  }
</script></body></html>