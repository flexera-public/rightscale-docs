<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>right_api_client times out when provisioning Windows instances on vSphere</title><meta content="This article addresses an issue where right_api_client times out when provisioning Windows instances on vSphere." name="description" /><meta content="initial-scale=1" name="viewport" /><link href="https://my.rightscale.com/favicon.ico" rel="icon" /><!--Stylesheets--><link href="../../../css/main.css" rel="stylesheet" /><!--JavaScript--><script src="../../../js/main.js"></script></head><body class="faq faq_clouds faq_clouds_vmware faq_clouds_vmware_right_api_client_times_out_when_provisioning_Windows_instances_on_vSphere" data-spy="scroll" data-target="#subnav-right"><nav class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container-fluid max-width"><div class="navbar-header"><button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="../../../img/FX_Logo_pos.png" /></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a target="_blank" href="https://community.flexera.com/t5/Flexera-Community/ct-p/Flexera_Community">Community</a></li><li><a target="_blank" href="https://www.flexera.com/blog/">Blog</a></li><li><a target="_blank" href="https://www.flexera.com/about-us/contact-us.html">Contact</a></li><li><a target="_blank" href="https://login.rightscale.com/login/session/new">Log In</a></li></ul><ul class="nav navbar-nav navbar-right nav-status"><li class="nav-al-search"><a href="../../../search.html">Search</a></li></ul><form class="navbar-form navbar-left" role="search" action="/search.html" method="get" ><div class="form-group"><input class="form-control input-sm" id="site-search" placeholder="Search" type="text" name="q" /></div><input type="submit" style="position: absolute; left: -9999px"/></form><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript"> docsearch({apiKey: 'b58c3ad6ab9d6e3cd425867d64a6766f',indexName: 'rightscale',inputSelector: '#site-search', debug: false, autocompleteOptions: {autoselect: false}});</script></div></div></nav><div class="wrap"><div class="container-fluid max-width"><div class="row"><div class="col-sm-3"><div class="clearfix"><aside class="main-nav" role="complementary"><nav class="list-group" role="navigations"><a class="list-group-item" href="/faq/"><h4 class="list-group-heading"><span>Frequently Asked Questions</span></h4></a><a class="list-group-item" href="/faq/">General</a><a class="list-group-item" href="/faq/clouds/aws">AWS</a><a class="list-group-item" href="/faq/clouds/google">Google Cloud Platform</a><a class="list-group-item" href="/faq/clouds/azure">Microsoft Azure</a><a class="list-group-item" href="/faq/clouds/softlayer">SoftLayer</a><a class="list-group-item" href="/faq/clouds/vmware">VMware</a></nav></aside><div class="callout"><a href="/api/"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../img/icon-api.svg" /><h4>Flexera CMP APIs</h4></div><span>See the API reference documentation for all of our products.</span></div></div></a></div><div class="callout"><a href="../../../ca/cloud_comp/ca_getting_started_with_cloud_comparison.html"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../img/icon-cloud-blue.svg" /><h4>Cloud Comparison</h4></div><span>Compare public clouds based on the features they offer.</span></div></div></a></div><div class="callout"><a target="_blank" href="http://feedback.rightscale.com"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../img/icon-feedback.svg" /><h4>Feedback</h4></div><span>Get in touch and we’ll get back to you as soon as we can.</span></div></div></a></div><div class="callout"><a href="/release-notes"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../img/icon-notes.svg" /><h4>Release Notes</h4></div><span>See the notes for the latest releases of each application and what’s changed.</span></div></div></a></div></div></div><div class="col-sm-9"><div class="row"><div class="col-sm-9"><div class="clearfix"><p><a href="../../../">Flexera CMP Docs</a> &#x2F; <a href="../../">RightScale General FAQs</a> &#x2F; <a href="../">Cloud Providers</a> &#x2F; <a href="./">VMware</a></p><div class="page-header"><h1>right_api_client times out when provisioning Windows instances on vSphere</h1></div><div class="main-content"><h2 id="overview">Overview</h2>

<p>When provisioning instances in vScale using the 1.5 API (especially when using the right-api-client) and you see a gateway timeout during the launch method on the server object like the following:</p>
<pre class="syntax-highlight html"><code>/Users/<span class="nt">&lt;USER</span><span class="na">_ID</span><span class="nt">&gt;</span>/.rbenv/versions/2.0.0-p451/gemsets/rsapi/gems/right_api_client-1.5.19/lib/right_api_client/client.rb:326:in `block (2 levels) in do_post': Error: HTTP Code: 504, Response body: <span class="nt">&lt;html&gt;&lt;body&gt;&lt;h1&gt;</span>504 Gateway Time-out<span class="nt">&lt;/h1&gt;</span> (RightApi::ApiError)
The server didn't respond in time.
<span class="nt">&lt;/body&gt;&lt;/html&gt;</span>
</code></pre>

<p>...this could be an issue with the timeout set in the RCA cloud appliance. Take note that this is an isolated specific use case and if you encounter this, follow the resolution below.</p>

<h2 id="resolution">Resolution</h2>

<p>In order to fix this issue, you need to set the default timeout from right-api to vSphere to 20 minutes. To do this, from the (RCA) adapter side, you will need to perform the following:</p>

<ol>
<li><p>In the RCA-V Admin UI, navigate to vCenter link on the left navigation column.</p>

<ul>
<li>Click Upgrade button in the Cloud Appliance (<strong>vScale</strong>) card.</li>
<li>Download the latest package (<strong>vscale_1.1_20140814_22</strong>)</li>
<li>Activate the package that you just downloaded using Activate button.</li>
</ul></li>
<li><p>SSH into the RCA-V adapter server and perform the following:</p>
<pre class="syntax-highlight plaintext"><code>$ sudo su
$ cd /etc/nginx/sites-enabled
$ vi vscale
</code></pre></li>
<li><p>Search the nginx configuration for <strong>proxy_read_timeout</strong> and change it to <strong>1200</strong> (it is currently set to 240) in /etc/nginx/sites-enabled/vscale</p>
<pre class="syntax-highlight plaintext"><code>location /gw {
    root /home/vscale/current/public;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_pass http://vscale-app;
    proxy_read_timeout 1200;
}
</code></pre></li>
<li><p>Save and then reboot the RCA-V VM.</p></li>
<li><p>In addition, if using right_api_client, the timeout will also needs to be passed as a parameter</p>
<pre class="syntax-highlight plaintext"><code>:timeout =&gt; 1200)
</code></pre></li>
</ol>
</div></div></div><div class="col-sm-3 hidden-xs affix-parent"><div class="clearfix" data-clampedwidth=".affix-parent" data-offset-bottom="200" data-offset-top="4" data-spy="affix"><nav class="subnav-right" id="subnav-right" role="sub-nav"><script>createRightHandNav();</script></nav></div></div></div></div></div></div></div><footer class="main-footer" role="contentinfo"><div class="container-fluid max-width"><div class="row"><div class="col-sm-10"><ul class="list-inline"><li><small>&copy; 2024 Flexera</small></li><li><a href="http://www.flexera.com/" target="_blank"><small>Flexera Home</small></a></li><li><a href="https://www.flexera.com/about-us/careers.html" target="_blank"><small>We're Hiring</small></a></li></ul></div></div></div></footer><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-KB9SMN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-KB9SMN');</script><script type="text/javascript">
  // Add clipboard button trigger
  var snippets = document.querySelectorAll('.syntax-highlight');
  [].forEach.call(snippets, function(snippet) {
  snippet.firstChild.insertAdjacentHTML('beforebegin', '<button class="btn snippet-clipboard" data-clipboard-snippet><img src="/img/icon-clipboard.svg"></button>');
  });

  // clipboard trigger
  var clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
  target: function(trigger) {
  return trigger.nextElementSibling;
  }
  });

  // Tooltip trigger
  clipboardSnippets.on('success', function(e) {
  e.clearSelection();
  showTooltip(e.trigger, 'Copied!');
  });

  // Error message
  clipboardSnippets.on('error', function(e) {
  showTooltip(e.trigger, fallbackMessage(e.action));
  });

  // Tooltip events
  var btns = document.querySelectorAll('.syntax-highlight .btn');
  for (var i = 0; i < btns.length; i++) {
  btns[i].addEventListener('mouseleave', clearTooltip);
  btns[i].addEventListener('blur', clearTooltip);
  }

  function clearTooltip(e) {
  e.currentTarget.setAttribute('class', 'btn');
  e.currentTarget.removeAttribute('aria-label');
  }

  function showTooltip(elem, msg) {
  elem.setAttribute('class', 'btn tooltipped tooltipped-s');
  elem.setAttribute('aria-label', msg);
  }
</script></body></html>