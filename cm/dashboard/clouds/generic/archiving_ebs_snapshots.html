<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>Archiving EBS Snapshots</title><meta content="The EBS Toolbox and EBS Stripe Toolbox v2 RightScale ServerTemplates provide additional control over the archiving of your EBS snapshots." name="description" /><meta content="initial-scale=1" name="viewport" /><link href="https://my.rightscale.com/favicon.ico" rel="icon" /><!--Stylesheets--><link href="../../../../css/main.css" rel="stylesheet" /><!--JavaScript--><script src="../../../../js/main.js"></script></head><body class="cm cm_dashboard cm_dashboard_clouds cm_dashboard_clouds_generic cm_dashboard_clouds_generic_archiving_ebs_snapshots" data-spy="scroll" data-target="#subnav-right"><nav class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container-fluid max-width"><div class="navbar-header"><button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="../../../../img/FX_Logo_pos.png" /></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a target="_blank" href="https://community.flexera.com/t5/Flexera-Community/ct-p/Flexera_Community">Community</a></li><li><a target="_blank" href="https://www.flexera.com/blog/">Blog</a></li><li><a target="_blank" href="https://www.flexera.com/about-us/contact-us.html">Contact</a></li><li><a target="_blank" href="https://login.rightscale.com/login/session/new">Log In</a></li></ul><ul class="nav navbar-nav navbar-right nav-status"><li class="nav-al-search"><a href="../../../../search.html">Search</a></li></ul><form class="navbar-form navbar-left" role="search" action="/search.html" method="get" ><div class="form-group"><input class="form-control input-sm" id="site-search" placeholder="Search" type="text" name="q" /></div><input type="submit" style="position: absolute; left: -9999px"/></form><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript"> docsearch({apiKey: 'b58c3ad6ab9d6e3cd425867d64a6766f',indexName: 'rightscale',inputSelector: '#site-search', debug: false, autocompleteOptions: {autoselect: false}});</script></div></div></nav><div class="wrap"><div class="container-fluid max-width"><div class="row"><div class="col-sm-3"><div class="clearfix"><aside class="main-nav" role="complementary"><nav class="list-group" role="navigations"><a class="list-group-item" href="/cm"><h4 class="list-group-heading"><img src="../../../../img/product-cloud-management.svg" /><span>Cloud Management</span></h4></a><a class="list-group-item" href="../../../about.html">About</a><a class="list-group-item" href="/cm/rs101/">Terminology and Concepts</a><a class="list-group-item" href="/cm/management_guide/">Lifecycle Management</a><a class="list-group-item" href="/cm/dashboard/">Dashboard User's Guide</a><a class="list-group-item" href="/cm/administrators_guide/">Administrator's Guide</a><a class="list-group-item" href="/cm/designers_guide/">Designer's Guide</a><a class="list-group-item" href="/cm/dashboard/design/server_templates/">ServerTemplates</a><a class="list-group-item" href="/cm/servertemplate_dev_guide/">ServerTemplate Developer's Guide</a><a class="list-group-item" href="/cm/pas/">Publishing and Sharing</a><a class="list-group-item" href="/cm/windows_guide/">Windows Guide</a><a class="list-group-item" href="/cm/ref/">Reference Information</a></nav></aside><div class="callout"><a href="/api/"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../../img/icon-api.svg" /><h4>Flexera CMP APIs</h4></div><span>See the API reference documentation for all of our products.</span></div></div></a></div><div class="callout"><a href="../../../../ca/cloud_comp/ca_getting_started_with_cloud_comparison.html"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../../img/icon-cloud-blue.svg" /><h4>Cloud Comparison</h4></div><span>Compare public clouds based on the features they offer.</span></div></div></a></div><div class="callout"><a target="_blank" href="http://feedback.rightscale.com"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../../img/icon-feedback.svg" /><h4>Feedback</h4></div><span>Get in touch and we’ll get back to you as soon as we can.</span></div></div></a></div><div class="callout"><a href="/release-notes"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../../img/icon-notes.svg" /><h4>Release Notes</h4></div><span>See the notes for the latest releases of each application and what’s changed.</span></div></div></a></div></div></div><div class="col-sm-9"><div class="row"><div class="col-sm-9"><div class="clearfix"><p><a href="../../../../">Flexera CMP Docs</a> &#x2F; <a href="../../../">Cloud Management</a> &#x2F; <a href="../../">Dashboard User's Guide</a> &#x2F; <a href="../">clouds</a> &#x2F; <a href="./">Generic Cloud Services</a></p><div class="page-header"><h1>Archiving EBS Snapshots</h1></div><div class="main-content"><h2 id="overview">Overview</h2>

<p>The <a href="http://www.rightscale.com/library/server_templates/EBS-Toolbox/775">EBS Toolbox</a> and <a href="http://www.rightscale.com/library/server_templates/EBS-Stripe-Toolbox-v2/13339">EBS Stripe Toolbox v2</a> ServerTemplates provide additional control over the archiving of your EBS snapshots.</p>

<h2 id="backup-scripts">Backup Scripts</h2>

<p>Two backup scripts are provided in the respective toolbox:</p>

<p><strong>EBS Stripe Toolbox v2</strong></p>

<ul>
<li><a href="http://www.rightscale.com/library/right_scripts/EBS-stripe-volume-backup-v2/13276">EBS stripe volume backup v2</a></li>
<li><a href="http://www.rightscale.com/library/right_scripts/EBS-continuous-backups-v2/12934">EBS continuous backups v2</a></li>
</ul>

<p><strong>EBS Toolbox</strong></p>

<ul>
<li><a href="http://www.rightscale.com/library/right_scripts/EBS-volume-backup/3966">EBS volume backup</a></li>
<li><a href="http://www.rightscale.com/library/right_scripts/EBS-volume-continuous-backups/3971">EBS volume continuous backups</a></li>
</ul>

<p>When &#39;EBS volume backup&#39; or &#39;EBS stripe volume backup v2&#39; RightScripts are run, an EBS snapshot is taken and the snapshots in the EBS_BACKUP_PREFIX lineage are pruned; the corresponding continuous backup script updates the regular backup cron job according to the Inputs (see below).</p>

<p>Use the following input values to control the number of EBS snapshots to prune and keep. The logic behind the archiving of snapshots uses the <q>EBS_BACKUP_PREFIX</q> to identify which snapshots should be saved. Therefore, if you manually change the name of a snapshot, the archiving logic will no longer apply to that snapshot. This functionality may be useful for making sure that a particular snapshot will not be accidentally deleted by the system.</p>

<h3 id="backup-scripts-ebs-snapshots-input-parameters">EBS Snapshots Input Parameters</h3>

<div class="alert alert-info" role="alert"><strong>Note:</strong><p>The <q>EBS_BACKUP_KEEP_LAST</q> and <q>EBS_BACKUP_PREFIX</q> inputs are mandatory; other inputs are optional.</p>
</div>

<table><thead>
<tr>
<th>Input Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>EBS_BACKUP_PREFIX</td>
<td>The prefix that will be used to name the EBS snapshots. (e.g., my_data)</td>
</tr>
<tr>
<td>EBS_BACKUP_FREQUENCY</td>
<td>Defines how frequently the snapshots should be taken. If set to ignore:ignore, hourly backups are taken.</td>
</tr>
<tr>
<td>EBS_BACKUP_KEEP_LAST</td>
<td>Defines how many of the last completed snapshots to keep. Value must be greater than zero. It counts from the latest snapshot backwards and preserves all backups in its count. (Default: 60)</td>
</tr>
<tr>
<td>EBS_BACKUP_KEEP_DAILY</td>
<td>Defines how many daily backups to keep. A daily backup is defined as the latest completed snapshot of a day that is closest to the end of the day (23:59:59). (Default: 14)</td>
</tr>
<tr>
<td>EBS_BACKUP_KEEP_WEEKLY</td>
<td>Defines how many weekly backups to keep. A weekly backup is defined as the latest completed snapshot of a week that is closest to the end of the week (Sunday 23:59:59). Monday is the first day of the week, Sunday is the last. (Default: 6)</td>
</tr>
<tr>
<td>EBS_BACKUP_KEEP_MONTHLY</td>
<td>Defines how many monthly backups to keep. A monthly backup is defined as the latest completed snapshot of a month that is closest to the end of the month (e.g. Jan-31; 23:59:59). (Default: 12)</td>
</tr>
<tr>
<td>EBS_BACKUP_KEEP_YEARLY</td>
<td>Defines how many yearly backups to keep. A yearly backup is defined as the latest completed snapshot of a year that is closest to the end of the year (e.g. Dec-31; 23:59:59). (Default: 2)</td>
</tr>
</tbody></table>

<p>Any changes to these input parameters will take effect immediately and cannot be reverted back to a previous state. For example, if you change your monthly backups from 6 to 4, the 2 oldest monthly backup snapshots will be deleted.</p>

<p>If all periods have one or more snapshots in them, the number specified in the inputs will exactly correspond to how many snapshots to keep for the last <q>n</q> period. For example, if you want 10 dailies and there are no holes or days where there are no snapshots in the history, you will end up keeping 1 backup for each one of the last 10 days.</p>

<p>If there are periods for which no backups exist at all due to a failed or deleted snapshot, the system will ignore them, and will continue going back in time until the number specified by the inputs has been fulfilled. In these cases, you will end up keeping the same number of backups, but they will span further into the past depending on how many snapshots are missing. For example, if you want to keep 10 dailies but last week you had 2 days for which no snapshot were generated, you will still keep 10 snapshots, but the oldest one being 12 days ago. If a snapshot fails (for whatever reason), the process will now sleep for a minute and retry (for a maximum of 2 retries).</p>

<p>Today&#39;s snapshots are not considered in the snapshot equation. For example, if you want to keep 3 dailies, the system will not consider today&#39;s snapshots as part of the equation. Snapshots of the three previous days will be archived. The equation will always start from yesterday and count backwards. The same logic applies to weeklies, monthlies, and yearlies, where the first snapshot to keep must be found in the last completed period. EBS_BACKUP_KEEP_LAST, on the other hand, truly keeps the last &#39;N&#39; backups that are completed including today&#39;s snapshots.</p>

<p>The alert for the EBS Snapshot records the time since the last successful snapshot, tracking both snapshot failures and when snapshots are disabled. You can set this alert to generate a notification if the age of the last snapshot exceeds <em>n</em> hours and get notified regardless if it is a failure or simply if snapshots are disabled.</p>

<h3 id="backup-scripts-example">Example</h3>

<p>Below is an example that helps show how the logic behind the archiving of snapshots can be applied to a setup where two EBS snapshots are saved each day.</p>

<p><img src="/img/cm-archive-snapshot-calendar-2.png" alt="cm-archive-snapshot-calendar-2.png" width="530" height="540" /></p>
</div></div></div><div class="col-sm-3 hidden-xs affix-parent"><div class="clearfix" data-clampedwidth=".affix-parent" data-offset-bottom="200" data-offset-top="4" data-spy="affix"><nav class="subnav-right" id="subnav-right" role="sub-nav"><script>createRightHandNav();</script></nav></div></div></div></div></div></div></div><footer class="main-footer" role="contentinfo"><div class="container-fluid max-width"><div class="row"><div class="col-sm-10"><ul class="list-inline"><li><small>&copy; 2024 Flexera</small></li><li><a href="http://www.flexera.com/" target="_blank"><small>Flexera Home</small></a></li><li><a href="https://www.flexera.com/about-us/careers.html" target="_blank"><small>We're Hiring</small></a></li></ul></div></div></div></footer><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-KB9SMN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-KB9SMN');</script><script type="text/javascript">
  // Add clipboard button trigger
  var snippets = document.querySelectorAll('.syntax-highlight');
  [].forEach.call(snippets, function(snippet) {
  snippet.firstChild.insertAdjacentHTML('beforebegin', '<button class="btn snippet-clipboard" data-clipboard-snippet><img src="/img/icon-clipboard.svg"></button>');
  });

  // clipboard trigger
  var clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
  target: function(trigger) {
  return trigger.nextElementSibling;
  }
  });

  // Tooltip trigger
  clipboardSnippets.on('success', function(e) {
  e.clearSelection();
  showTooltip(e.trigger, 'Copied!');
  });

  // Error message
  clipboardSnippets.on('error', function(e) {
  showTooltip(e.trigger, fallbackMessage(e.action));
  });

  // Tooltip events
  var btns = document.querySelectorAll('.syntax-highlight .btn');
  for (var i = 0; i < btns.length; i++) {
  btns[i].addEventListener('mouseleave', clearTooltip);
  btns[i].addEventListener('blur', clearTooltip);
  }

  function clearTooltip(e) {
  e.currentTarget.setAttribute('class', 'btn');
  e.currentTarget.removeAttribute('aria-label');
  }

  function showTooltip(elem, msg) {
  elem.setAttribute('class', 'btn tooltipped tooltipped-s');
  elem.setAttribute('aria-label', msg);
  }
</script></body></html>