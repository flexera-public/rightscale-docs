<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>Upgrade of Application Servers</title><meta content="Steps for performing a minor upgrade to your Application Servers in your RightScale Deployment. This upgrade assumes you are using dedicated load balancers." name="description" /><meta content="initial-scale=1" name="viewport" /><link href="https://my.rightscale.com/favicon.ico" rel="icon" /><!--Stylesheets--><link href="../../css/main.css" rel="stylesheet" /><!--JavaScript--><script src="../../js/main.js"></script></head><body class="cm cm_management_guide cm_management_guide_upgrade_of_application_servers" data-spy="scroll" data-target="#subnav-right"><nav class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container-fluid max-width"><div class="navbar-header"><button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="../../img/FX_Logo_pos.png" /></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a target="_blank" href="https://community.flexera.com/t5/Flexera-Community/ct-p/Flexera_Community">Community</a></li><li><a target="_blank" href="https://www.flexera.com/blog/">Blog</a></li><li><a target="_blank" href="https://www.flexera.com/about-us/contact-us.html">Contact</a></li><li><a target="_blank" href="https://login.rightscale.com/login/session/new">Log In</a></li></ul><ul class="nav navbar-nav navbar-right nav-status"><li class="nav-al-search"><a href="../../search.html">Search</a></li></ul><form class="navbar-form navbar-left" role="search" action="/search.html" method="get" ><div class="form-group"><input class="form-control input-sm" id="site-search" placeholder="Search" type="text" name="q" /></div><input type="submit" style="position: absolute; left: -9999px"/></form><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript"> docsearch({apiKey: 'b58c3ad6ab9d6e3cd425867d64a6766f',indexName: 'rightscale',inputSelector: '#site-search', debug: false, autocompleteOptions: {autoselect: false}});</script></div></div></nav><div class="wrap"><div class="container-fluid max-width"><div class="row"><div class="col-sm-3"><div class="clearfix"><aside class="main-nav" role="complementary"><nav class="list-group" role="navigations"><a class="list-group-item" href="/cm"><h4 class="list-group-heading"><img src="../../img/product-cloud-management.svg" /><span>Cloud Management</span></h4></a><a class="list-group-item" href="../about.html">About</a><a class="list-group-item" href="/cm/rs101/">Terminology and Concepts</a><a class="list-group-item" href="/cm/management_guide/">Lifecycle Management</a><a class="list-group-item" href="/cm/dashboard/">Dashboard User's Guide</a><a class="list-group-item" href="/cm/administrators_guide/">Administrator's Guide</a><a class="list-group-item" href="/cm/designers_guide/">Designer's Guide</a><a class="list-group-item" href="/cm/dashboard/design/server_templates/">ServerTemplates</a><a class="list-group-item" href="/cm/servertemplate_dev_guide/">ServerTemplate Developer's Guide</a><a class="list-group-item" href="/cm/pas/">Publishing and Sharing</a><a class="list-group-item" href="/cm/windows_guide/">Windows Guide</a><a class="list-group-item" href="/cm/ref/">Reference Information</a></nav></aside><div class="callout"><a href="/api/"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-api.svg" /><h4>Flexera CMP APIs</h4></div><span>See the API reference documentation for all of our products.</span></div></div></a></div><div class="callout"><a href="../../ca/cloud_comp/ca_getting_started_with_cloud_comparison.html"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-cloud-blue.svg" /><h4>Cloud Comparison</h4></div><span>Compare public clouds based on the features they offer.</span></div></div></a></div><div class="callout"><a target="_blank" href="http://feedback.rightscale.com"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-feedback.svg" /><h4>Feedback</h4></div><span>Get in touch and we’ll get back to you as soon as we can.</span></div></div></a></div><div class="callout"><a href="/release-notes"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-notes.svg" /><h4>Release Notes</h4></div><span>See the notes for the latest releases of each application and what’s changed.</span></div></div></a></div></div></div><div class="col-sm-9"><div class="row"><div class="col-sm-9"><div class="clearfix"><p><a href="../../">Flexera CMP Docs</a> &#x2F; <a href="../">Cloud Management</a> &#x2F; <a href="./">Lifecycle Management</a></p><div class="page-header"><h1>Upgrade of Application Servers</h1></div><div class="main-content"><h2 id="overview">Overview</h2>

<p>You need to perform a minor upgrade to the application servers in your production environment. This upgrade assumes you&#39;re using dedicated load balancers. For this type of upgrade you could update a variety of things such as the ServerTemplate revision, RightImages<sup>TM</sup>, application code, and Inputs. However, this upgrade assumes that you are only making minor changes/additions to the database. If you are making incompatible changes to the database schema, your site upgrade will require site downtime. See the <a href="/cm/management_guide/major_software_upgrade_scenarios.html">Major Software Upgrade Scenarios</a> section for details.</p>

<h2 id="steps">Steps</h2>

<p>The following steps assume that you&#39;ve already followed best practices by creating a staging Deployment for development and testing purposes. Once you&#39;ve properly tested all of your system and software upgrades, you are now ready to upgrade your production setup.</p>

<p><img src="/img/cm-minor-upgrade-apps1.png" alt="cm-minor-upgrade-apps1.png" width="322" height="299" /></p>

<ol>
<li>If you are making minor changes to your database schema, first take a snapshot of your database before you make any modifications. Create a manual backup (EBS Snapshot) of your Master-DB by running the <strong>db::do_primary_backup</strong> Chef recipe or the <strong>DB EBS Backup</strong> operational script. If the upgrade is not successful, you can always use this snapshot to revert the database back to its original state before the upgrade began.</li>
<li>Run any pre-upgrade DB migrations such as adding new tables or indexes.</li>
<li>Clone an application server in the production Deployment. If possible, you should always start an upgrade with a clone from one of the existing application servers in your production environment. This way, you&#39;re ensured that you always start with an exact duplicate of a running and stable production server with the same configurations. Later, when you change a configuration and something breaks, you&#39;ll know exactly what caused the problem. If you add a server using a new ServerTemplate and tried to configure it the same way as your production server, you are simply more prone to human error.<br>
<img src="/img/cm-minor-upgrade-apps2.png" alt="cm-minor-upgrade-apps2.png" width="459" height="299" /></li>
<li>Make any systems level changes to the new server.<br>
<img src="/img/cm-minor-upgrade-apps3.png" alt="cm-minor-upgrade-apps3.png" width="720" height="299" /></li>
<li>In the next step you will modify the inputs at the Deployment level. Go to the Deployment&#39;s <strong>Inputs</strong> tab. As a safety precaution, you should save a copy of the Deployment&#39;s current Input settings before you make any changes. Use the <a href="/cm/dashboard/manage/deployments/deployments_actions.html#download-csv-of-external-repositories">Download CSV of External References</a> action button to save a .csv file of your input settings. This way, if problems occur you can always revert back to the original settings. Remember, there is no version control at the Deployment level.</li>
<li>Make any application level changes to the server by modifying inputs at the Deployment level. Remember, inputs that are defined at the Deployment level only affect new servers that are launched. The original application servers will keep their inputs (as long as you don&#39;t relaunch or execute a script on them).

<ul>
<li>Specify the location of the latest application code (&#39;Repository URL/ROS Container&#39;, &#39;Repository Branch/Tag/Commit inputs&#39;)</li>
<li>Define values for any new inputs that were introduced by new RightScripts (that you want to define at the Deployment level)</li>
</ul></li>
<li>Launch and test the new application server to make sure that it can properly connect to the database. If problems occur, shutdown the server. You might have to launch and test the server after each modification to determine the exact cause of the problem.</li>
<li>If the new server looks stable, clone it and launch an additional application server.<br>
<img src="/img/cm-minor-upgrade-apps4.png" alt="cm-minor-upgrade-apps4.png" width="602" height="299" /><br></li>
<li>Test the second application server to make sure that it can properly connect to the database. Repeat as necessary until you have equal number of old and new application servers.</li>
<li>Disable the array (if applicable) so no new application servers can be launched. Any servers that are already running in the Server Array will remain operational.</li>
<li>At the Deployment level, run the <strong>lb::do_attach_all</strong> Chef recipe or the <strong>LB Application to HAProxy Connect</strong> operational script to connect the new application servers to the existing load balancers so they can start receiving traffic. Select only the new application servers when running the RightScript.</li>
<li>Depending on how your application is coded, there may be existing sessions opened to your old application servers that we do not want to prematurely disconnect. In this case, the best strategy is to manually or programmatically remove the health check file used on the old application server(s). When removing the health check file, HAProxy will fail the health check tests, which will allow no new sessions to the application server, however existing application server sessions will be preserved.</li>
<li>Once the health check file is removed from your old application servers, feel free to monitor the existing sessions on these servers. This can be done in many ways, but the easiest may be to check the HAProxy status dashboard for the server and it&#39;s associated sessions. From the HAProxy status dashboard, you can view the current and total number of sessions active on the application server as well as any queued sessions, if applicable.</li>
<li>Once you have verified that all sessions have ceased on the old application servers, it is time to disconnect them from the load balancer. On the Deployment level, run the <strong>lb::do_detach_request</strong> Chef recipe or the <strong>LB Application to HAProxy Disconnect</strong> operational script to disconnect the old application servers from the existing load balancers so no new users will be sent to the old application servers. Be <em>SURE</em> to select only the &#39;old&#39; application servers when running the RightScript! We do <em>not</em> want to disconnect the newly launched/modified application servers_._<br>
<img src="/img/cm-minor-upgrade-apps5.png" alt="cm-minor-upgrade-apps5.png" width="602" height="299" /></li>
<li>Make any systems level changes to the server array (if applicable). For example, update the ServerTemplate of the Server Array. Make sure that any inputs that you&#39;ve defined at the deployment will not be overwritten because they are defined at the Server Array level.</li>
<li>Enable the Server Array (if applicable).</li>
<li>Test site. Monitor log files.</li>
<li>Terminate old application servers when convenient. Terminate any old servers in the array. Always use discretion before terminating servers. Remember, if you terminate a server, you will end any active sessions unless steps 12-14 were followed above. You can always check a server&#39;s Apache monitoring graphs for active sessions or safely terminate the server after its TTL has expired.<br>
<img src="/img/cm-minor-upgrade-apps6.png" alt="cm-minor-upgrade-apps6.png" width="602" height="299" /></li>
</ol>
</div></div></div><div class="col-sm-3 hidden-xs affix-parent"><div class="clearfix" data-clampedwidth=".affix-parent" data-offset-bottom="200" data-offset-top="4" data-spy="affix"><nav class="subnav-right" id="subnav-right" role="sub-nav"><script>createRightHandNav();</script></nav></div></div></div></div></div></div></div><footer class="main-footer" role="contentinfo"><div class="container-fluid max-width"><div class="row"><div class="col-sm-10"><ul class="list-inline"><li><small>&copy; 2024 Flexera</small></li><li><a href="http://www.flexera.com/" target="_blank"><small>Flexera Home</small></a></li><li><a href="https://www.flexera.com/about-us/careers.html" target="_blank"><small>We're Hiring</small></a></li></ul></div></div></div></footer><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-KB9SMN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-KB9SMN');</script><script type="text/javascript">
  // Add clipboard button trigger
  var snippets = document.querySelectorAll('.syntax-highlight');
  [].forEach.call(snippets, function(snippet) {
  snippet.firstChild.insertAdjacentHTML('beforebegin', '<button class="btn snippet-clipboard" data-clipboard-snippet><img src="/img/icon-clipboard.svg"></button>');
  });

  // clipboard trigger
  var clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
  target: function(trigger) {
  return trigger.nextElementSibling;
  }
  });

  // Tooltip trigger
  clipboardSnippets.on('success', function(e) {
  e.clearSelection();
  showTooltip(e.trigger, 'Copied!');
  });

  // Error message
  clipboardSnippets.on('error', function(e) {
  showTooltip(e.trigger, fallbackMessage(e.action));
  });

  // Tooltip events
  var btns = document.querySelectorAll('.syntax-highlight .btn');
  for (var i = 0; i < btns.length; i++) {
  btns[i].addEventListener('mouseleave', clearTooltip);
  btns[i].addEventListener('blur', clearTooltip);
  }

  function clearTooltip(e) {
  e.currentTarget.setAttribute('class', 'btn');
  e.currentTarget.removeAttribute('aria-label');
  }

  function showTooltip(elem, msg) {
  elem.setAttribute('class', 'btn tooltipped tooltipped-s');
  elem.setAttribute('aria-label', msg);
  }
</script></body></html>