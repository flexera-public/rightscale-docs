<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>Collectd Plugin Apache Log Monitor</title><meta content="The collectd plugin gathers useful information from the Apache log file for both monitoring and alert purposes in the RightScale Cloud Management Platform." name="description" /><meta content="initial-scale=1" name="viewport" /><link href="https://my.rightscale.com/favicon.ico" rel="icon" /><!--Stylesheets--><link href="../../css/main.css" rel="stylesheet" /><!--JavaScript--><script src="../../js/main.js"></script></head><body class="cm cm_rs101 cm_rs101_collectd_plugin_apache_log_monitor" data-spy="scroll" data-target="#subnav-right"><nav class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container-fluid max-width"><div class="navbar-header"><button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="../../img/FX_Logo_pos.png" /></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a target="_blank" href="https://community.flexera.com/t5/Flexera-Community/ct-p/Flexera_Community">Community</a></li><li><a target="_blank" href="https://www.flexera.com/blog/">Blog</a></li><li><a target="_blank" href="https://www.flexera.com/about-us/contact-us.html">Contact</a></li><li><a target="_blank" href="https://login.rightscale.com/login/session/new">Log In</a></li></ul><ul class="nav navbar-nav navbar-right nav-status"><li class="nav-al-search"><a href="../../search.html">Search</a></li></ul><form class="navbar-form navbar-left" role="search" action="/search.html" method="get" ><div class="form-group"><input class="form-control input-sm" id="site-search" placeholder="Search" type="text" name="q" /></div><input type="submit" style="position: absolute; left: -9999px"/></form><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript"> docsearch({apiKey: 'b58c3ad6ab9d6e3cd425867d64a6766f',indexName: 'rightscale',inputSelector: '#site-search', debug: false, autocompleteOptions: {autoselect: false}});</script></div></div></nav><div class="wrap"><div class="container-fluid max-width"><div class="row"><div class="col-sm-3"><div class="clearfix"><aside class="main-nav" role="complementary"><nav class="list-group" role="navigations"><a class="list-group-item" href="/cm"><h4 class="list-group-heading"><img src="../../img/product-cloud-management.svg" /><span>Cloud Management</span></h4></a><a class="list-group-item" href="../about.html">About</a><a class="list-group-item" href="/cm/rs101/">Terminology and Concepts</a><a class="list-group-item" href="/cm/management_guide/">Lifecycle Management</a><a class="list-group-item" href="/cm/dashboard/">Dashboard User's Guide</a><a class="list-group-item" href="/cm/administrators_guide/">Administrator's Guide</a><a class="list-group-item" href="/cm/designers_guide/">Designer's Guide</a><a class="list-group-item" href="/cm/dashboard/design/server_templates/">ServerTemplates</a><a class="list-group-item" href="/cm/servertemplate_dev_guide/">ServerTemplate Developer's Guide</a><a class="list-group-item" href="/cm/pas/">Publishing and Sharing</a><a class="list-group-item" href="/cm/windows_guide/">Windows Guide</a><a class="list-group-item" href="/cm/ref/">Reference Information</a></nav></aside><div class="callout"><a href="/api/"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-api.svg" /><h4>Flexera CMP APIs</h4></div><span>See the API reference documentation for all of our products.</span></div></div></a></div><div class="callout"><a href="../../ca/cloud_comp/ca_getting_started_with_cloud_comparison.html"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-cloud-blue.svg" /><h4>Cloud Comparison</h4></div><span>Compare public clouds based on the features they offer.</span></div></div></a></div><div class="callout"><a target="_blank" href="http://feedback.rightscale.com"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-feedback.svg" /><h4>Feedback</h4></div><span>Get in touch and we’ll get back to you as soon as we can.</span></div></div></a></div><div class="callout"><a href="/release-notes"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-notes.svg" /><h4>Release Notes</h4></div><span>See the notes for the latest releases of each application and what’s changed.</span></div></div></a></div></div></div><div class="col-sm-9"><div class="row"><div class="col-sm-9"><div class="clearfix"><p><a href="../../">Flexera CMP Docs</a> &#x2F; <a href="../">Cloud Management</a> &#x2F; <a href="./">Cloud Management - Terminology and Concepts</a></p><div class="page-header"><h1>Collectd Plugin Apache Log Monitor</h1></div><div class="main-content"><h2 id="objective">Objective</h2>

<p>This plugin gathers useful information from the Apache log file for both monitoring and alert purposes. This plugin tails the Apache access log based on the Apache LogFormat directive that you supply. The Apache plugin will help you get started monitoring more data from the Apache log.</p>

<p>And the dataum to be monitored and plotted are (but is not limited to):</p>

<ul>
<li>number of 200 OK hits per second</li>
<li>number of 301/302 hits per second</li>
<li>number of 2xx/3xx hits per second</li>
<li>number of 404 hits per second</li>
<li>number of 403 hits per second</li>
<li>number of 4xx hits per second</li>
<li>number of 5xx hits per second</li>
<li>response time for every request - (Not viewable by default. Must be enabled. See instructions that follow.)</li>
<li>response time for 2xx/3xx - (Not viewable by default. Must be enabled. See instructions that follow.)</li>
<li>response time for 4xx/5xx - (Not viewable by default. Must be enabled. See instructions that follow.)</li>
<li>response size for every request</li>
<li>response size for 2xx/3xx</li>
<li>response size for 4xx/5xx</li>
<li>response time acceleration - Represents the increase/decrease in responses over time.</li>
<li>error hits acceleration (both 4xx and 5xx) rate - Represents the increase/decrease in errors over time.</li>
</ul>

<h3 id="objective-example">Example</h3>

<p>The <strong>error hits acceleration</strong> and <strong>response time acceleration</strong> can be useful for detecting whether or not there is a problem with how pages are being served to clients or whether a problem will exist in the near future.</p>

<p>For example, if the <strong>response time acceleration</strong> increases (&gt; 0.0), it could be caused by too many hits to the site, which might cause the site to slow down or perhaps it is caused by a problem with the application, etc. You could also use the response time rate to help predict when the server will start to break down if it continues to increase at the same rate.</p>

<p>You can also set up an alert specification so that your system administrator receives an email notification when problems occur.</p>

<h2 id="installation-and-configuration">Installation and Configuration</h2>

<p>Use the following steps to set up the Apache plugin to collect and monitor Apache response time data so that you can use one of the predefined alert specifications to take action when problems related to Apache response times occur.</p>

<ol>
<li>Enable the Collection of Response Time Data.</li>
<li>Add the <q>SYS Monitoring Apache Log Add</q> RightScript - You must add this script in order to monitor the collected Apache data.</li>
<li>Add an Alert Specification.</li>
</ol>

<h3 id="installation-and-configuration-enable-the-collection-of-response-time-data">Enable the Collection of Response Time Data</h3>

<p>Before you can view any of the response time data, you must first modify the Apache configuration. In order to enable the collection of response time data, you must add the <q>response time</q> (%D) to the Apache LogFormat Directive and also input the LogFormat to the plugin by using the <q>-l</q> option. By default, Apache uses the LogFormat <q>combined</q> format:</p>
<pre class="syntax-highlight plaintext"><code>LogFormat "%h %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
</code></pre>

<p>and the plugin uses the same format for the <q>-l</q> option:</p>
<pre class="syntax-highlight plaintext"><code>"-l" "%h %l %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-Agent}i\""
</code></pre>

<h3 id="installation-and-configuration-add-the--sys-monitoring-apache-log-add--rightscript">Add the "SYS Monitoring Apache Log Add" RightScript</h3>

<p>You must add the <strong>SYS Monitoring Apache Log Add</strong> RightScript to your ServerTemplate in order to monitor the Apache response data. Import this <a href="http://www.rightscale.com/library/right_scripts/SYS-Monitoring-Apache-Log-Add/lineage/2771">RightScript</a> from the MultiCloud Marketplace.</p>

<p><img src="/img/cm-apache-rightscript.png" alt="cm-apache-rightscript.png" width="547" height="98" />  </p>

<h3 id="installation-and-configuration-add-an-alert-specification">Add an Alert Specification</h3>

<p>You may want to set up an alert specification and escalation that sends an email when Apache-related problems occur. You can either use one of the alert specifications related to Apache or create your own. See <strong>Design</strong> &gt; <strong>Alerts</strong> &gt; <strong>Specifications</strong>.</p>

<ul>
<li><strong>rs increase in error status</strong> - If apache-log/gauge-error_hits_acceleration.value &gt; &#39;0.00&#39; for 30 min then escalate to &#39;warning&#39;.</li>
<li><strong>rs increase in response time</strong> - If apache-log/gauge-response_time_acceleration.value &gt; &#39;0.00&#39; for 30 min then escalate to &#39;warning&#39;.</li>
</ul>

<h2 id="apache-log-plugin-options">Apache-Log Plugin Options</h2>

<p>This collectd exec plugin gathers Apache info by parsing the apache log file. This plugin demostrates a simple way to create a custom collectd plugin for monitoring purposes.</p>

<p>-f, --apache-log FILE<br>
 This is the absolute path of the Apache access log. (default: /var/log/httpd/access_log)  </p>

<p>-l, --apache-logformat LOGFORMAT<br>
 Parsing the log requires the Apache LogFormat directive for this log file. (default: Apache &#39;combined&#39; LogFormat)  </p>

<p>-b, --backup-log FILE<br>
 This option sets the path where the file is backed up, which restores the data from last time. (default: /tmp/apache_log_monitor.backup)  </p>

<p>-i, --hostid INSTANCE ID<br>
 The instance id of which the data is being collected.  </p>

<p>-n, --sampling-interval INTERVAL<br>
 The interval (in seconds) between each sampling. The max interval is 15 seconds. (default: 10 seconds)  </p>

<p>-a, --acceleration-interval INTERVAL<br>
 The interval (in seconds) between each acceleration rate sampling. (default: 300 seconds)  </p>

<p>-h, --help</p>

<p>Once you&#39;ve installed the plugin, you can find it in /usr/lib*/collectd/plugin. You can change configuration options by modifying /etc/collectd.d/apache_log_monitor.conf .</p>

<h3 id="apache-log-plugin-options-example">Example</h3>
<pre class="syntax-highlight plaintext"><code>    &lt;Plugin exec&gt;
      # userid plugin executable plugin args
      Exec "apache" "$collectd_dir/plugins/apache_log_monitor" "-l" "%h %l %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-Agent}i\""
    &lt;/Plugin&gt;
</code></pre>

<h2 id="see-also">See also</h2>

<ul>
<li><a href="http://collectd.org/wiki/index.php/Plugin:Apache">Collectd Plugin:Apache</a></li>
</ul>
</div></div></div><div class="col-sm-3 hidden-xs affix-parent"><div class="clearfix" data-clampedwidth=".affix-parent" data-offset-bottom="200" data-offset-top="4" data-spy="affix"><nav class="subnav-right" id="subnav-right" role="sub-nav"><script>createRightHandNav();</script></nav></div></div></div></div></div></div></div><footer class="main-footer" role="contentinfo"><div class="container-fluid max-width"><div class="row"><div class="col-sm-10"><ul class="list-inline"><li><small>&copy; 2024 Flexera</small></li><li><a href="http://www.flexera.com/" target="_blank"><small>Flexera Home</small></a></li><li><a href="https://www.flexera.com/about-us/careers.html" target="_blank"><small>We're Hiring</small></a></li></ul></div></div></div></footer><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-KB9SMN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-KB9SMN');</script><script type="text/javascript">
  // Add clipboard button trigger
  var snippets = document.querySelectorAll('.syntax-highlight');
  [].forEach.call(snippets, function(snippet) {
  snippet.firstChild.insertAdjacentHTML('beforebegin', '<button class="btn snippet-clipboard" data-clipboard-snippet><img src="/img/icon-clipboard.svg"></button>');
  });

  // clipboard trigger
  var clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
  target: function(trigger) {
  return trigger.nextElementSibling;
  }
  });

  // Tooltip trigger
  clipboardSnippets.on('success', function(e) {
  e.clearSelection();
  showTooltip(e.trigger, 'Copied!');
  });

  // Error message
  clipboardSnippets.on('error', function(e) {
  showTooltip(e.trigger, fallbackMessage(e.action));
  });

  // Tooltip events
  var btns = document.querySelectorAll('.syntax-highlight .btn');
  for (var i = 0; i < btns.length; i++) {
  btns[i].addEventListener('mouseleave', clearTooltip);
  btns[i].addEventListener('blur', clearTooltip);
  }

  function clearTooltip(e) {
  e.currentTarget.setAttribute('class', 'btn');
  e.currentTarget.removeAttribute('aria-label');
  }

  function showTooltip(elem, msg) {
  elem.setAttribute('class', 'btn tooltipped tooltipped-s');
  elem.setAttribute('aria-label', msg);
  }
</script></body></html>