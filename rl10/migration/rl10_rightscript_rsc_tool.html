<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>Use of RSC tool in RightScripts</title><meta content="Use of the RSC tool in RightScripts." name="description" /><meta content="initial-scale=1" name="viewport" /><link href="https://my.rightscale.com/favicon.ico" rel="icon" /><!--Stylesheets--><link href="../../css/main.css" rel="stylesheet" /><!--JavaScript--><script src="../../js/main.js"></script></head><body class="rl10 rl10_migration rl10_migration_rl10_rightscript_rsc_tool" data-spy="scroll" data-target="#subnav-right"><nav class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container-fluid max-width"><div class="navbar-header"><button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="../../img/FX_Logo_pos.png" /></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a target="_blank" href="https://community.flexera.com/t5/Flexera-Community/ct-p/Flexera_Community">Community</a></li><li><a target="_blank" href="https://www.flexera.com/blog/">Blog</a></li><li><a target="_blank" href="https://www.flexera.com/about-us/contact-us.html">Contact</a></li><li><a target="_blank" href="https://login.rightscale.com/login/session/new">Log In</a></li></ul><ul class="nav navbar-nav navbar-right nav-status"><li class="nav-al-search"><a href="../../search.html">Search</a></li></ul><form class="navbar-form navbar-left" role="search" action="/search.html" method="get" ><div class="form-group"><input class="form-control input-sm" id="site-search" placeholder="Search" type="text" name="q" /></div><input type="submit" style="position: absolute; left: -9999px"/></form><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript"> docsearch({apiKey: 'b58c3ad6ab9d6e3cd425867d64a6766f',indexName: 'rightscale',inputSelector: '#site-search', debug: false, autocompleteOptions: {autoselect: false}});</script></div></div></nav><div class="wrap"><div class="container-fluid max-width"><div class="row"><div class="col-sm-3"><div class="clearfix"><aside class="main-nav" role="complementary"><nav class="list-group" role="navigations"><a class="list-group-item" href="/rl10"><h4 class="list-group-heading"><span>RightLink 10</span></h4></a><a class="list-group-item" href="../about.html">About</a><a class="list-group-item" href="../getting_started.html">Getting Started</a><a class="list-group-item" href="../os_use_case_cloud_support.html">Operating System,<br> Use Case, and Cloud Support</a><a class="list-group-item" href="/rl10/reference">Reference</a><a class="list-group-item" href="/rl10/releases">Releases</a><a class="list-group-item" href="/rl10/tools">Tools</a><a class="list-group-item" href="/rl10/migration">Migration Guide</a></nav></aside><div class="callout"><a href="/api/"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-api.svg" /><h4>Flexera CMP APIs</h4></div><span>See the API reference documentation for all of our products.</span></div></div></a></div><div class="callout"><a href="../../ca/cloud_comp/ca_getting_started_with_cloud_comparison.html"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-cloud-blue.svg" /><h4>Cloud Comparison</h4></div><span>Compare public clouds based on the features they offer.</span></div></div></a></div><div class="callout"><a target="_blank" href="http://feedback.rightscale.com"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-feedback.svg" /><h4>Feedback</h4></div><span>Get in touch and we’ll get back to you as soon as we can.</span></div></div></a></div><div class="callout"><a href="/release-notes"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-notes.svg" /><h4>Release Notes</h4></div><span>See the notes for the latest releases of each application and what’s changed.</span></div></div></a></div></div></div><div class="col-sm-9"><div class="row"><div class="col-sm-9"><div class="clearfix"><p><a href="../../">Flexera CMP Docs</a> &#x2F; <a href="../">RightLink 10</a> &#x2F; <a href="./">Migration Guide</a></p><div class="page-header"><h1>Use of RSC tool in RightScripts</h1></div><div class="main-content"><p>The <a href="https://github.com/rightscale/rsc/blob/master/README.md">RSC tool</a> is installed with RightLink 10 which provides a command line interface for interacting with RightScale&#39;s <a href="https://github.com/rightscale/rsc/blob/master/README.md#instance-facing-apis">instance facing APIs</a>. The following are examples that can be added to a RightScript:</p>

<h2 id="volume-management">Volume management</h2>

<p>Following bash script example executed on Google instances will create a 10GB volume named &#39;Volume1&#39; and attach it to the instance:</p>
<pre class="syntax-highlight shell"><code><span class="c">#!/bin/bash</span>
<span class="c"># ---</span>
<span class="c"># RightScript Name: Volume Create and Attach</span>
<span class="c"># Description: Creates and attaches a volume</span>
<span class="c"># Inputs: {}</span>
<span class="c"># ...</span>

<span class="nv">volume_name</span><span class="o">=</span><span class="s2">"Volume1"</span>
<span class="nv">volume_size</span><span class="o">=</span><span class="s2">"10"</span>
<span class="nv">device_location</span><span class="o">=</span><span class="s2">"persistent-disk-1"</span>

<span class="nv">retry_args</span><span class="o">=</span><span class="s2">"--retry=5 --timeout=60"</span>

<span class="c"># Obtain instance information, making a single request to RightScale</span>
<span class="nv">instance_info</span><span class="o">=</span><span class="k">$(</span>rsc <span class="nv">$retry_args</span> --rl10 cm15 index_instance_session /api/sessions/instance<span class="k">)</span>

<span class="c"># Instance HREF</span>
<span class="nv">instance_href</span><span class="o">=</span><span class="k">$(</span>rsc --x1 <span class="s1">':has(.rel:val("self")).href'</span> json <span class="o">&lt;&lt;&lt;</span> <span class="nv">$instance_info</span><span class="k">)</span>

<span class="c"># Datacenter HREF</span>
<span class="nv">datacenter_href</span><span class="o">=</span><span class="k">$(</span>rsc --x1 <span class="s1">':has(.rel:val("datacenter")).href'</span> json <span class="o">&lt;&lt;&lt;</span> <span class="nv">$instance_info</span><span class="k">)</span>

<span class="c"># Cloud HREF</span>
<span class="nv">cloud_href</span><span class="o">=</span><span class="k">$(</span>rsc --x1 <span class="s1">':has(.rel:val("cloud")).href'</span> json <span class="o">&lt;&lt;&lt;</span> <span class="nv">$instance_info</span><span class="k">)</span>

<span class="c"># Create new volume</span>
<span class="nv">newvol_href</span><span class="o">=</span><span class="k">$(</span>rsc <span class="nv">$retry_args</span> --xh<span class="o">=</span>Location --rl10 cm15 create <span class="nv">$cloud_href</span>/volumes <span class="se">\</span>
  <span class="s2">"volume[name]=</span><span class="nv">$volume_name</span><span class="s2">"</span> <span class="se">\</span>
  <span class="s2">"volume[size]=</span><span class="nv">$volume_size</span><span class="s2">"</span> <span class="se">\</span>
  <span class="s2">"volume[datacenter_href]=</span><span class="nv">$datacenter_href</span><span class="s2">"</span><span class="k">)</span>

<span class="c"># Wait for volume to become available</span>
<span class="k">until</span> <span class="o">[</span> <span class="s2">"</span><span class="k">$(</span>rsc --rl10 cm15 show <span class="nv">$newvol_href</span> --x1 .status<span class="k">)</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"available"</span> <span class="o">]</span>; <span class="k">do
  </span><span class="nb">echo</span> <span class="s2">"waiting for volume to become available"</span>
  sleep 2
<span class="k">done</span>

<span class="c"># Attach volume to instance</span>
rsc <span class="nv">$retry_args</span> --rl10 cm15 create <span class="nv">$cloud_href</span>/volume_attachments <span class="se">\</span>
  <span class="s2">"volume_attachment[instance_href]=</span><span class="nv">$instance_href</span><span class="s2">"</span> <span class="se">\</span>
  <span class="s2">"volume_attachment[volume_href]=</span><span class="nv">$newvol_href</span><span class="s2">"</span> <span class="se">\</span>
  <span class="s2">"volume_attachment[device]=</span><span class="nv">$device_location</span><span class="s2">"</span>
</code></pre>

<h2 id="volume-snapshot-management">Volume snapshot management</h2>

<p>Following bash script example executed on Google instances will take a snapshot of all attached volumes on the instance:</p>
<pre class="syntax-highlight shell"><code><span class="c">#!/bin/bash</span>
<span class="c"># ---</span>
<span class="c"># RightScript Name: Volume Create Snapshot</span>
<span class="c"># Description: Takes a snapshot of all attached volumes</span>
<span class="c"># Inputs: {}</span>
<span class="c"># ...</span>

<span class="nv">retry_args</span><span class="o">=</span><span class="s2">"--retry=5 --timeout=60"</span>

<span class="c"># Obtain instance HREF</span>
<span class="nv">instance_href</span><span class="o">=</span><span class="k">$(</span>rsc <span class="nv">$retry_args</span> --rl10 cm15 index_instance_session /api/sessions/instance <span class="se">\</span>
  --x1 <span class="s1">':has(.rel:val("self")).href'</span><span class="k">)</span>

<span class="c"># Obtain all attached volumes</span>
<span class="nv">attached_volumes_hrefs</span><span class="o">=</span><span class="k">$(</span>rsc <span class="nv">$retry_args</span> --rl10 cm15 index <span class="nv">$instance_href</span>/volume_attachments <span class="se">\</span>
  --xm <span class="s1">':has(.rel:val("volume")).href'</span><span class="k">)</span>

<span class="c"># Request snapshot for each attached volume</span>
<span class="k">for </span>volume_href <span class="k">in</span> <span class="nv">$attached_volumes_hrefs</span>; <span class="k">do
  </span><span class="nv">volume_href</span><span class="o">=</span><span class="k">$(</span>tr -d <span class="se">\"</span> <span class="o">&lt;&lt;&lt;</span> <span class="nv">$volume_href</span><span class="k">)</span>
  <span class="nv">volume_name</span><span class="o">=</span><span class="k">$(</span>rsc <span class="nv">$retry_args</span> --rl10 cm15 show <span class="nv">$volume_href</span> --x1 .name<span class="k">)</span>
  rsc <span class="nv">$retry_args</span> --rl10 cm15 create <span class="nv">$volume_href</span>/volume_snapshots <span class="se">\</span>
    <span class="s2">"volume_snapshot[name]=</span><span class="nv">$volume_name</span><span class="s2">"</span>
<span class="k">done</span>
</code></pre>

<p>Following bash script example executed on Google instances will keep the 10 latest snapshots and deleting the others:</p>
<pre class="syntax-highlight shell"><code><span class="c">#!/bin/bash</span>
<span class="c"># ---</span>
<span class="c"># RightScript Name: Volume Snapshot Cleanup</span>
<span class="c"># Description: Deletes older snapshots, keeping the 10 most recent</span>
<span class="c"># Inputs: {}</span>
<span class="c"># ...</span>

<span class="nv">snapshots_retained</span><span class="o">=</span>10

<span class="c"># Obtain cloud HREF</span>
<span class="nv">cloud_href</span><span class="o">=</span><span class="k">$(</span>rsc --retry<span class="o">=</span>5 --timeout<span class="o">=</span>60 --rl10 cm15 <span class="se">\</span>
  index_instance_session /api/sessions/instance --x1 <span class="s1">':has(.rel:val("cloud")).href'</span><span class="k">)</span>

<span class="c"># Obtain instance HREF</span>
<span class="nv">instance_href</span><span class="o">=</span><span class="k">$(</span>rsc --retry<span class="o">=</span>5 --timeout<span class="o">=</span>60 --rl10 cm15 <span class="se">\</span>
  index_instance_session /api/sessions/instance --x1 <span class="s1">':has(.rel:val("self")).href'</span><span class="k">)</span>

<span class="c"># Obtain all attached volumes</span>
<span class="nv">attached_volumes_hrefs</span><span class="o">=</span><span class="k">$(</span>rsc --retry<span class="o">=</span>5 --timeout<span class="o">=</span>60 --rl10 cm15 <span class="se">\</span>
  index <span class="nv">$instance_href</span>/volume_attachments --xm <span class="s1">':has(.rel:val("volume")).href'</span><span class="k">)</span>

<span class="c"># Delete old snapshots for each attached volumes</span>
<span class="k">for </span>volume_href <span class="k">in</span> <span class="nv">$attached_volumes_hrefs</span>; <span class="k">do
  </span><span class="nv">volume_href</span><span class="o">=</span><span class="k">$(</span>tr -d <span class="se">\"</span> <span class="o">&lt;&lt;&lt;</span> <span class="nv">$volume_href</span><span class="k">)</span>
  <span class="nv">snapshots</span><span class="o">=</span><span class="k">$(</span>rsc --retry<span class="o">=</span>5 --timeout<span class="o">=</span>60 --rl10 cm15 index <span class="nv">$cloud_href</span>/volume_snapshots <span class="se">\</span>
    <span class="s2">"filter[]=parent_volume_href==</span><span class="nv">$volume_href</span><span class="s2">"</span><span class="k">)</span>
  <span class="nv">delete_dates</span><span class="o">=</span><span class="k">$(</span>rsc --xm .created_at json <span class="o">&lt;&lt;&lt;</span> <span class="nv">$snapshots</span> | sort -r | <span class="se">\</span>
    tail -n +<span class="k">$((</span>snapshots_retained+1<span class="k">)))</span>
  <span class="nv">IFS</span><span class="o">=</span><span class="nv">$'</span><span class="se">\n</span><span class="s1">'
  for delete_date in $delete_dates; do
    delete_date=$(tr -d \" &lt;&lt;&lt; $delete_date)
    snapshot_href=$(rsc --xm ":has(.created_at:val(\"$delete_date\"))" json &lt;&lt;&lt; $snapshots | \
      rsc --x1 '</span>:has<span class="o">(</span>.rel:val<span class="o">(</span><span class="s2">"self"</span><span class="o">))</span>.href<span class="s1">' json)
    rsc --retry=5 --timeout=60 --rl10 cm15 destroy $snapshot_href
  done
  unset IFS
done
</span></code></pre>

<h2 id="machine-tag-management">Machine tag management</h2>

<p>Following bash script examples executed on Google instances will add, list, and remove tags from an instance:</p>
<pre class="syntax-highlight shell"><code><span class="c">#!/bin/bash</span>
<span class="c"># ---</span>
<span class="c"># RightScript Name: Tags Add</span>
<span class="c"># Description: Adds a machine tag</span>
<span class="c"># Inputs: {}</span>
<span class="c"># ...</span>

<span class="nv">tag</span><span class="o">=</span><span class="s2">"rightscale:tag=example"</span>

<span class="c"># Obtain instance HREF</span>
<span class="nv">instance_href</span><span class="o">=</span><span class="k">$(</span>rsc --retry<span class="o">=</span>5 --timeout<span class="o">=</span>60 --rl10 cm15 <span class="se">\</span>
  index_instance_session /api/sessions/instance --x1 <span class="s1">':has(.rel:val("self")).href'</span><span class="k">)</span>

<span class="c"># Adding tag</span>
rsc --retry<span class="o">=</span>5 --timeout<span class="o">=</span>60 --rl10 cm15 multi_add /api/tags/multi_add <span class="se">\</span>
  <span class="s2">"resource_hrefs[]=</span><span class="nv">$instance_href</span><span class="s2">"</span> <span class="se">\</span>
  <span class="s2">"tags[]=</span><span class="nv">$tag</span><span class="s2">"</span>
</code></pre>
<pre class="syntax-highlight shell"><code><span class="c">#!/bin/bash</span>
<span class="c"># ---</span>
<span class="c"># RightScript Name: Tags List</span>
<span class="c"># Description: List all machine tags</span>
<span class="c"># Inputs: {}</span>
<span class="c"># ...</span>

<span class="c"># Obtain instance HREF</span>
<span class="nv">instance_href</span><span class="o">=</span><span class="k">$(</span>rsc --retry<span class="o">=</span>5 --timeout<span class="o">=</span>60 --rl10 cm15 <span class="se">\</span>
  index_instance_session /api/sessions/instance --x1 <span class="s1">':has(.rel:val("self")).href'</span><span class="k">)</span>

<span class="c"># List tags</span>
rsc --retry<span class="o">=</span>5 --timeout<span class="o">=</span>60 --rl10 cm15 by_resource /api/tags/by_resource <span class="se">\</span>
  <span class="s2">"resource_hrefs[]=</span><span class="nv">$instance_href</span><span class="s2">"</span> --xm .name<span class="se">\</span>
</code></pre>
<pre class="syntax-highlight shell"><code><span class="c">#!/bin/bash</span>
<span class="c"># ---</span>
<span class="c"># RightScript Name: Tags Remove</span>
<span class="c"># Description: Removes a machine tag</span>
<span class="c"># Inputs: {}</span>
<span class="c"># ...</span>

<span class="nv">tag</span><span class="o">=</span><span class="s2">"rightscale:tag=example"</span>

<span class="c"># Obtain instance HREF</span>
<span class="nv">instance_href</span><span class="o">=</span><span class="k">$(</span>rsc --retry<span class="o">=</span>5 --timeout<span class="o">=</span>60 --rl10 cm15 <span class="se">\</span>
  index_instance_session /api/sessions/instance --x1 <span class="s1">':has(.rel:val("self")).href'</span><span class="k">)</span>

<span class="c"># Delete tag</span>
rsc --retry<span class="o">=</span>5 --timeout<span class="o">=</span>60 --rl10 cm15 multi_delete /api/tags/multi_delete <span class="se">\</span>
  <span class="s2">"resource_hrefs[]=</span><span class="nv">$instance_href</span><span class="s2">"</span> <span class="se">\</span>
  <span class="s2">"tags[]=</span><span class="nv">$tag</span><span class="s2">"</span>
</code></pre>
</div></div></div><div class="col-sm-3 hidden-xs affix-parent"><div class="clearfix" data-clampedwidth=".affix-parent" data-offset-bottom="200" data-offset-top="4" data-spy="affix"><nav class="subnav-right" id="subnav-right" role="sub-nav"><script>createRightHandNav();</script></nav></div></div></div></div></div></div></div><footer class="main-footer" role="contentinfo"><div class="container-fluid max-width"><div class="row"><div class="col-sm-10"><ul class="list-inline"><li><small>&copy; 2024 Flexera</small></li><li><a href="http://www.flexera.com/" target="_blank"><small>Flexera Home</small></a></li><li><a href="https://www.flexera.com/about-us/careers.html" target="_blank"><small>We're Hiring</small></a></li></ul></div></div></div></footer><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-KB9SMN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-KB9SMN');</script><script type="text/javascript">
  // Add clipboard button trigger
  var snippets = document.querySelectorAll('.syntax-highlight');
  [].forEach.call(snippets, function(snippet) {
  snippet.firstChild.insertAdjacentHTML('beforebegin', '<button class="btn snippet-clipboard" data-clipboard-snippet><img src="/img/icon-clipboard.svg"></button>');
  });

  // clipboard trigger
  var clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
  target: function(trigger) {
  return trigger.nextElementSibling;
  }
  });

  // Tooltip trigger
  clipboardSnippets.on('success', function(e) {
  e.clearSelection();
  showTooltip(e.trigger, 'Copied!');
  });

  // Error message
  clipboardSnippets.on('error', function(e) {
  showTooltip(e.trigger, fallbackMessage(e.action));
  });

  // Tooltip events
  var btns = document.querySelectorAll('.syntax-highlight .btn');
  for (var i = 0; i < btns.length; i++) {
  btns[i].addEventListener('mouseleave', clearTooltip);
  btns[i].addEventListener('blur', clearTooltip);
  }

  function clearTooltip(e) {
  e.currentTarget.setAttribute('class', 'btn');
  e.currentTarget.removeAttribute('aria-label');
  }

  function showTooltip(elem, msg) {
  elem.setAttribute('class', 'btn tooltipped tooltipped-s');
  elem.setAttribute('aria-label', msg);
  }
</script></body></html>