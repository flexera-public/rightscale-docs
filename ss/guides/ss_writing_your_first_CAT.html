<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>Writing Your First CAT</title><meta content="CAT stands for Cloud Application Template - it contains the definition of your application. A CAT has two primary purposes - to define the resources required by your application, and to define workflows that control the behavior of your application." name="description" /><meta content="initial-scale=1" name="viewport" /><link href="https://my.rightscale.com/favicon.ico" rel="icon" /><!--Stylesheets--><link href="../../css/main.css" rel="stylesheet" /><!--JavaScript--><script src="../../js/main.js"></script></head><body class="ss ss_guides ss_guides_ss_writing_your_first_CAT" data-spy="scroll" data-target="#subnav-right"><nav class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container-fluid max-width"><div class="navbar-header"><button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="../../img/FX_Logo_pos.png" /></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a target="_blank" href="https://community.flexera.com/t5/Flexera-Community/ct-p/Flexera_Community">Community</a></li><li><a target="_blank" href="https://www.flexera.com/blog/">Blog</a></li><li><a target="_blank" href="https://www.flexera.com/about-us/contact-us.html">Contact</a></li><li><a target="_blank" href="https://login.rightscale.com/login/session/new">Log In</a></li></ul><ul class="nav navbar-nav navbar-right nav-status"><li class="nav-al-search"><a href="../../search.html">Search</a></li></ul><form class="navbar-form navbar-left" role="search" action="/search.html" method="get" ><div class="form-group"><input class="form-control input-sm" id="site-search" placeholder="Search" type="text" name="q" /></div><input type="submit" style="position: absolute; left: -9999px"/></form><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript"> docsearch({apiKey: 'b58c3ad6ab9d6e3cd425867d64a6766f',indexName: 'rightscale',inputSelector: '#site-search', debug: false, autocompleteOptions: {autoselect: false}});</script></div></div></nav><div class="wrap"><div class="container-fluid max-width"><div class="row"><div class="col-sm-3"><div class="clearfix"><aside class="main-nav" role="complementary"><nav class="list-group" role="navigations"><a class="list-group-item" href="/ss/"><h4 class="list-group-heading"><img src="../../img/product-self-service.svg" /><span>Self-Service</span></h4></a><a class="list-group-item" href="../about.html">About</a><a class="list-group-item" href="/ss/getting_started">Getting Started</a><a class="list-group-item" href="/ss/guides">Guides</a><a class="list-group-item" href="/ss/reference">Reference</a><a class="list-group-item" href="/ss/tools">Tools</a></nav></aside><div class="callout"><a href="/api/"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-api.svg" /><h4>Flexera CMP APIs</h4></div><span>See the API reference documentation for all of our products.</span></div></div></a></div><div class="callout"><a href="../../ca/cloud_comp/ca_getting_started_with_cloud_comparison.html"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-cloud-blue.svg" /><h4>Cloud Comparison</h4></div><span>Compare public clouds based on the features they offer.</span></div></div></a></div><div class="callout"><a target="_blank" href="http://feedback.rightscale.com"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-feedback.svg" /><h4>Feedback</h4></div><span>Get in touch and we’ll get back to you as soon as we can.</span></div></div></a></div><div class="callout"><a href="/release-notes"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-notes.svg" /><h4>Release Notes</h4></div><span>See the notes for the latest releases of each application and what’s changed.</span></div></div></a></div></div></div><div class="col-sm-9"><div class="row"><div class="col-sm-9"><div class="clearfix"><div class="page-header"><h1>Writing Your First CAT</h1></div><div class="main-content"><h2 id="overview">Overview</h2>

<p>CAT stands for Cloud Application Template - it contains the definition of your application. A CAT has two primary purposes: to define the resources required by your application, and to define workflows that control the behavior of your application. A CAT also contains descriptions of inputs from your user, outputs back to your users, and how to display information in the Self-Service portal.</p>

<p><img src="/img/ss_cat_breakdown.png" alt="CAT Breakdown Image" width="681" height="605" /></p>

<p>CAT files are uploaded to Self-Service, published to the Catalog as CloudApps that can be launched by users, and then launched by users to create a running CloudApp.</p>

<p>Since CAT files are simple text files, they can and should be managed in your existing source control tools. For now, Self-Service provides only very simple CAT management tools, but no version control or change tracking capabilities. Soon, Self-Service will provide tighter integration into your source control system, such as Github.</p>

<h2 id="name-and-description">Name and Description</h2>

<p>Every CAT file contains metadata about the CloudApp that it defines, such as its name and description. When creating a CloudApp, make sure to give it a name that is meaningful to your users and provide at least a short description that describes what the app does, or what its content is.</p>
<pre class="syntax-highlight ruby"><code><span class="nb">name</span> <span class="s2">"3 Tier Application with MySQL (PHP and Tomcat)"</span>
<span class="n">rs_ca_ver</span> <span class="mi">20161221</span>
<span class="n">short_description</span> <span class="s2">"Provides a 3-tier application consisting of 1 HAProxy load balancer, 1 application server, and a master-slave database pair"</span>
</code></pre>

<p>The <code>name</code> and <code>short_description</code> of the CloudApp show in the Catalog when users are browsing for CloudApps to launch. The <code>long_description</code> is shown when someone clicks the “Details” button in the Catalog.</p>

<p><img src="/img/ss_catalog_card.png" alt="Catalog Image" width="478" height="316" /></p>

<p>When authoring the descriptions, use <a href="http://daringfireball.net/projects/markdown/syntax">markdown syntax</a> to provide nice formatting of the text and even embed images or links into your descriptions. Take care when adding images to the short description, as images that are too large can cause strange UI artifacts such as wrapping or scrolling in the Catalog view.</p>

<h2 id="defining-a-resource">Defining a Resource</h2>

<p>At its core, a CloudApp is a container of cloud resources and workflow definitions that operate on those resources. A CloudApp can contain any number of a variety of resource types, and additional resource types can be defined via Self-Service plugins. Built-in resources include most resources available in <a href="/api/">RightScale Cloud Management API 1.5</a>, such as Servers, Server Arrays, IP Addresses, Security Groups, and more.</p>

<p>There are many approaches to defining resources in your CAT: they can be created from scratch, copied from other CATs, or exported from RightScale Cloud Management. To export from Cloud Management, see Exporting Deployments to CAT</p>

<p>Every resource contains a set of attributes that are used when creating, launching, or operating on the resource. In the example below, we are creating a RightScale Server resource by specifying the required attributes, such as which ServerTemplate to use and which cloud to launch in.</p>
<pre class="syntax-highlight ruby"><code><span class="n">resource</span> <span class="s2">"srv_db_master"</span><span class="p">,</span> <span class="ss">type: </span><span class="s2">"server"</span> <span class="k">do</span>
  <span class="nb">name</span> <span class="s2">"Database Master"</span>
  <span class="n">cloud</span> <span class="s2">"EC2 us-west-2"</span>
  <span class="n">security_groups</span> <span class="s2">"3tier-all-oregon"</span>
  <span class="n">ssh_key</span> <span class="s2">"default"</span>
  <span class="n">server_template</span> <span class="n">find</span><span class="p">(</span><span class="s2">"Database Manager for MySQL 5.5 (v13.3)"</span><span class="p">,</span> <span class="ss">revision: </span><span class="mi">111</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<p>Resources can be grouped together in a CAT and can reference each other in their definitions. In the example below, we are creating an IPAddress resource (an EIP in AWS) and using it and the Server defined above to bind the EIP to the instance.</p>
<pre class="syntax-highlight ruby"><code><span class="n">resource</span> <span class="s2">"db_ip_address"</span><span class="p">,</span> <span class="ss">type: </span><span class="s2">"ip_address"</span> <span class="k">do</span>
  <span class="n">cloud</span> <span class="s2">"EC2 us-west-2"</span>
<span class="k">end</span>

<span class="n">resource</span> <span class="s2">"db_ip_binding"</span><span class="p">,</span> <span class="ss">type: </span><span class="s2">"ip_address_binding"</span> <span class="k">do</span>
  <span class="n">cloud</span> <span class="s2">"EC2 us-west-2"</span>
  <span class="n">instance</span> <span class="vi">@srv_db_master</span>
  <span class="n">public_ip_address</span> <span class="vi">@db_ip_address</span>
<span class="k">end</span>
</code></pre>

<p>For the full list of Cloud Management API 1.5 resources supported by Self-Service, see the <a href="../reference/ss_CAT_resources.html">CAT Resource Reference</a>.</p>

<p>For more information on mappings, see the <a href="../reference/ss_CAT_file_language.html#mappings">CAT Language Reference</a>.</p>

<h2 id="getting-user-input">Getting User Input</h2>

<p>Parameters are used to provide input to your CloudApp when it is launched or when custom operations are run. You define Parameters in your CAT file using a <code>parameter</code> declaration, and then can use the values elsewhere in your CAT by referring to them by name. Since these will be shown to users, the definition includes display attributes for rendering in the Self-Service portal.</p>

<p>The code below shows two examples of Parameters - one that allows the user to pick from a set of pre-defined values, and the other that allows the user to enter free-form text. In the example, both are used in the resource definition for the server.</p>
<pre class="syntax-highlight ruby"><code><span class="n">parameter</span> <span class="s2">"cloud"</span> <span class="k">do</span>
  <span class="n">type</span> <span class="s2">"string"</span>
  <span class="n">label</span> <span class="s2">"Cloud"</span>
  <span class="n">allowed_values</span> <span class="s2">"AWS Oregon"</span><span class="p">,</span> <span class="s2">"VMware"</span>
  <span class="n">description</span> <span class="s2">"The cloud in which to launch the server"</span>
<span class="k">end</span>

<span class="n">parameter</span> <span class="s2">"server_name"</span> <span class="k">do</span>
  <span class="n">type</span> <span class="s2">"string"</span>
  <span class="n">label</span> <span class="s2">"Server Name"</span>
  <span class="n">description</span> <span class="s2">"The name to give the server"</span>
<span class="k">end</span>

<span class="n">resource</span> <span class="s2">"srv_db_master"</span><span class="p">,</span> <span class="ss">type: </span><span class="s2">"server"</span> <span class="k">do</span>
  <span class="nb">name</span> <span class="vg">$server_name</span>
  <span class="n">cloud</span> <span class="vg">$cloud</span>
  <span class="n">security_groups</span> <span class="s2">"3tier-all-oregon"</span>
  <span class="n">ssh_key</span> <span class="s2">"default"</span>
  <span class="n">server_template</span> <span class="n">find</span><span class="p">(</span><span class="s2">"Database Manager for MySQL 5.5 (v13.3)"</span><span class="p">,</span> <span class="ss">revision: </span><span class="mi">111</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<p>Parameters have many more attributes that can be leveraged to perform validation, define when they are shown, categorize them for UI organization, and more. For the full reference of a Parameter definition, see the <a href="../reference/ss_CAT_file_language.html#parameters">CAT Language Reference</a>.</p>

<h2 id="using-lookup-tables">Using Lookup Tables</h2>

<p>There are many scenarios in which you will need to get user input for your CloudApp, but the input either won’t be used directly on your resource or the input will affect many different properties of a resource. For example, if you provide an input to select which cloud to run in, that may affect not only which cloud a resource is launched in, but also its datacenter and instance type values.</p>

<p>In this case, CAT provides a Mapping, which allows you to use a Parameter input (or other strings) to lookup a set of values that can be used elsewhere in your CAT. The <code>mapping</code> declaration contains the string values, and the <code>map()</code> function is used to access them in your CAT.</p>

<p>In the example below, we implement a Mapping to contain various values based on what the user selected for the cloud parameter, then we use the <code>map</code> function in our resource declaration to leverage those values.</p>
<pre class="syntax-highlight ruby"><code><span class="n">parameter</span> <span class="s2">"cloud"</span> <span class="k">do</span>
  <span class="n">type</span> <span class="s2">"string"</span>
  <span class="n">label</span> <span class="s2">"Cloud"</span>
  <span class="n">allowed_values</span> <span class="s2">"AWS Oregon"</span><span class="p">,</span> <span class="s2">"VMware"</span>
  <span class="n">description</span> <span class="s2">"The cloud in which to launch the server"</span>
<span class="k">end</span>

<span class="n">mapping</span> <span class="s2">"cloud_mapping"</span> <span class="k">do</span> <span class="p">{</span>
  <span class="s2">"AWS Oregon"</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="s2">"datacenter"</span> <span class="o">=&gt;</span> <span class="s2">"us-west-2a"</span><span class="p">,</span>
    <span class="s2">"instance_type"</span> <span class="o">=&gt;</span> <span class="s2">"m1.large"</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="s2">"VMware"</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="s2">"datacenter"</span> <span class="o">=&gt;</span> <span class="s2">"internal-1"</span><span class="p">,</span>
    <span class="s2">"instance_type"</span> <span class="o">=&gt;</span> <span class="s2">"large"</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">}</span> <span class="k">end</span>

<span class="n">resource</span> <span class="s2">"srv_db_master"</span><span class="p">,</span> <span class="ss">type: </span><span class="s2">"server"</span> <span class="k">do</span>
  <span class="nb">name</span> <span class="s2">"DB Server"</span>
  <span class="n">cloud</span> <span class="vg">$cloud</span>
  <span class="n">datacenter</span> <span class="n">map</span><span class="p">(</span><span class="vg">$cloud_mapping</span><span class="p">,</span> <span class="vg">$cloud</span><span class="p">,</span> <span class="s2">"datacenter"</span><span class="p">)</span>
  <span class="n">instance_type</span> <span class="n">map</span><span class="p">(</span><span class="vg">$cloud_mapping</span><span class="p">,</span> <span class="vg">$cloud</span><span class="p">,</span> <span class="s2">"instance_type"</span><span class="p">)</span>
  <span class="n">server_template</span> <span class="n">find</span><span class="p">(</span><span class="s2">"Database Manager for MySQL 5.5 (v13.3)"</span><span class="p">,</span> <span class="ss">revision: </span><span class="mi">111</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<p>For more information on mappings, see the <a href="../reference/ss_CAT_file_language.html#mappings">CAT Language Reference</a>.</p>

<h2 id="providing-information-to-the-user">Providing Information to the User</h2>

<p>Once a CloudApp has been launched by a user, you will want to provide some information to them about how to use the application. In some cases this may as simple as providing an IP address of a server, but in many cases you will want to leverage some more complex logic and combination of properties to show the user something meaningful.</p>

<p>Outputs can be defined in your CAT that define what information to show back to the user and how to render that information. Outputs can be provided with a default value that will be shown, or can be explicitly set as a result of running an Operation. The example below shows how you would show the user the name and IP address of a running server.</p>
<pre class="syntax-highlight ruby"><code><span class="n">output</span> <span class="k">do</span>
  <span class="n">label</span> <span class="s2">"Server IP Address"</span>
  <span class="n">category</span> <span class="s2">"General"</span>
  <span class="n">default_value</span> <span class="vi">@srv_db_master</span><span class="p">.</span><span class="nf">public_ip_address</span>
<span class="k">end</span>

<span class="n">output</span> <span class="k">do</span>
  <span class="n">label</span> <span class="s2">"Server Name"</span>
  <span class="n">category</span> <span class="s2">"General"</span>
  <span class="n">default_value</span> <span class="vi">@srv_db_master</span><span class="p">.</span><span class="nf">name</span>
<span class="k">end</span>
</code></pre>

<p>For more information on outputs, see the <a href="../reference/ss_CAT_file_language.html#outputs">CAT Language Reference</a>.</p>

<h2 id="defining-workflows">Defining Workflows</h2>

<p>Underlying the Self-Service system is a powerful workflow engine called RightScale Cloud Workflow. This engine is a fully featured workflow engine with its own language and easy to use constructs for parallelism, error handling, and more. At the end of the day, all actions on a Cloud Application are defined by underlying workflow definitions. Some of these definitions are internal to the system, but you can also define your own workflows to use with a CloudApp.</p>

<p>A workflow definition is associated with a CloudApp by defining Operations. Most Operations are classified as “custom” operations, but there are also a few “special” operations that can be leveraged during launch, terminate, and scheduled events.</p>

<p>In the example below, we define a custom Operation called “Update application code” which references a fairly straightforward workflow definition that calls a script on a running server. Although this workflow definition is simple, workflows can be extremely complex, as dictated by your use case and application.</p>
<pre class="syntax-highlight ruby"><code><span class="n">operation</span> <span class="s2">"Update application code"</span> <span class="k">do</span>
  <span class="n">description</span> <span class="s2">"Update the application code with the latest from the source"</span>
  <span class="n">definition</span> <span class="s2">"update_app_code"</span>
<span class="k">end</span>

<span class="n">define</span> <span class="n">update_app_code</span><span class="p">(</span><span class="vi">@srv_app</span><span class="p">)</span> <span class="k">do</span>
  <span class="vi">@task</span> <span class="o">=</span> <span class="vi">@srv_app</span><span class="p">.</span><span class="nf">current_instance</span><span class="p">().</span><span class="nf">run_executable</span><span class="p">(</span><span class="ss">recipe_name: </span><span class="s2">"app::do_update_code"</span><span class="p">,</span> <span class="ss">inputs: </span><span class="p">{})</span>
  <span class="n">sleep_until</span><span class="p">(</span><span class="vi">@task</span><span class="p">.</span><span class="nf">summary</span> <span class="o">=~</span> <span class="s2">"^(completed|failed)"</span><span class="p">)</span>
  <span class="k">if</span> <span class="vi">@task</span><span class="p">.</span><span class="nf">summary</span> <span class="o">=~</span> <span class="s2">"failed"</span>
    <span class="k">raise</span> <span class="s2">"Failed to run app::do_update_code"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>For more information on operations, see the <a href="../reference/ss_CAT_file_language.html#operations">CAT Language Reference</a>.</p>

<p>For more information about Cloud Workflow, see the <a href="../reference/ss_RCL_language.html">Cloud Workflow Language</a>.</p>

<h2 id="customizing-launch-behavior">Customizing Launch Behavior</h2>

<p>By default, the logic used to launch a CloudApplication is to sequentially create and launch all resources defined in the CAT in the order in which they’re defined. Note that some resource types may be created earlier in the process if they’re required by others (an IP address will be created before a Server if the Server depends on it).</p>

<p>If your application has an order in which things should be launched instead of the default, you can specify a workflow definition with your own logic. To define the behavior on launch, use the special operation called “launch”. In the example below, a workflow is defined to concurrently launch our servers instead of the default sequential behavior.</p>
<pre class="syntax-highlight ruby"><code><span class="n">operation</span> <span class="s1">'launch'</span> <span class="k">do</span>
  <span class="n">definition</span> <span class="s1">'launch_application'</span>
  <span class="n">description</span> <span class="s1">'Creates all the servers'</span>
<span class="k">end</span>

<span class="n">define</span> <span class="n">launch_application</span><span class="p">(</span><span class="vi">@server1</span><span class="p">,</span> <span class="vi">@server2</span><span class="p">)</span> <span class="k">return</span> <span class="vi">@server1</span><span class="p">,</span> <span class="vi">@server2</span> <span class="k">do</span>
  <span class="n">concurrent</span> <span class="k">return</span> <span class="vi">@server1</span><span class="p">,</span> <span class="vi">@server2</span> <span class="k">do</span>
    <span class="n">provision</span><span class="p">(</span><span class="vi">@server1</span><span class="p">)</span>
    <span class="n">provision</span><span class="p">(</span><span class="vi">@server2</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<!---For more complex examples, see the [Samples](/ss/samples) section of this handbook.--->
</div></div></div><div class="col-sm-3 hidden-xs affix-parent"><div class="clearfix" data-clampedwidth=".affix-parent" data-offset-bottom="200" data-offset-top="4" data-spy="affix"><nav class="subnav-right" id="subnav-right" role="sub-nav"><script>createRightHandNav();</script></nav></div></div></div></div></div></div></div><footer class="main-footer" role="contentinfo"><div class="container-fluid max-width"><div class="row"><div class="col-sm-10"><ul class="list-inline"><li><small>&copy; 2024 Flexera</small></li><li><a href="http://www.flexera.com/" target="_blank"><small>Flexera Home</small></a></li><li><a href="https://www.flexera.com/about-us/careers.html" target="_blank"><small>We're Hiring</small></a></li></ul></div></div></div></footer><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-KB9SMN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-KB9SMN');</script><script type="text/javascript">
  // Add clipboard button trigger
  var snippets = document.querySelectorAll('.syntax-highlight');
  [].forEach.call(snippets, function(snippet) {
  snippet.firstChild.insertAdjacentHTML('beforebegin', '<button class="btn snippet-clipboard" data-clipboard-snippet><img src="/img/icon-clipboard.svg"></button>');
  });

  // clipboard trigger
  var clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
  target: function(trigger) {
  return trigger.nextElementSibling;
  }
  });

  // Tooltip trigger
  clipboardSnippets.on('success', function(e) {
  e.clearSelection();
  showTooltip(e.trigger, 'Copied!');
  });

  // Error message
  clipboardSnippets.on('error', function(e) {
  showTooltip(e.trigger, fallbackMessage(e.action));
  });

  // Tooltip events
  var btns = document.querySelectorAll('.syntax-highlight .btn');
  for (var i = 0; i < btns.length; i++) {
  btns[i].addEventListener('mouseleave', clearTooltip);
  btns[i].addEventListener('blur', clearTooltip);
  }

  function clearTooltip(e) {
  e.currentTarget.setAttribute('class', 'btn');
  e.currentTarget.removeAttribute('aria-label');
  }

  function showTooltip(elem, msg) {
  elem.setAttribute('class', 'btn tooltipped tooltipped-s');
  elem.setAttribute('aria-label', msg);
  }
</script></body></html>