<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>Dynamic Parameters - LABS</title><meta content="This LABS feature allows for CAT parameter values to be dynamically changed during launch time based on other parameter values or on external API calls." name="description" /><meta content="initial-scale=1" name="viewport" /><link href="https://my.rightscale.com/favicon.ico" rel="icon" /><!--Stylesheets--><link href="../../css/main.css" rel="stylesheet" /><!--JavaScript--><script src="../../js/main.js"></script></head><body class="ss ss_guides ss_guides_ss_dynamic_parameters" data-spy="scroll" data-target="#subnav-right"><nav class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container-fluid max-width"><div class="navbar-header"><button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="../../img/FX_Logo_pos.png" /></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a target="_blank" href="https://community.flexera.com/t5/Flexera-Community/ct-p/Flexera_Community">Community</a></li><li><a target="_blank" href="https://www.flexera.com/blog/">Blog</a></li><li><a target="_blank" href="https://www.flexera.com/about-us/contact-us.html">Contact</a></li><li><a target="_blank" href="https://login.rightscale.com/login/session/new">Log In</a></li></ul><ul class="nav navbar-nav navbar-right nav-status"><li class="nav-al-search"><a href="../../search.html">Search</a></li></ul><form class="navbar-form navbar-left" role="search" action="/search.html" method="get" ><div class="form-group"><input class="form-control input-sm" id="site-search" placeholder="Search" type="text" name="q" /></div><input type="submit" style="position: absolute; left: -9999px"/></form><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript"> docsearch({apiKey: 'b58c3ad6ab9d6e3cd425867d64a6766f',indexName: 'rightscale',inputSelector: '#site-search', debug: false, autocompleteOptions: {autoselect: false}});</script></div></div></nav><div class="wrap"><div class="container-fluid max-width"><div class="row"><div class="col-sm-3"><div class="clearfix"><aside class="main-nav" role="complementary"><nav class="list-group" role="navigations"><a class="list-group-item" href="/ss/"><h4 class="list-group-heading"><img src="../../img/product-self-service.svg" /><span>Self-Service</span></h4></a><a class="list-group-item" href="../about.html">About</a><a class="list-group-item" href="/ss/getting_started">Getting Started</a><a class="list-group-item" href="/ss/guides">Guides</a><a class="list-group-item" href="/ss/reference">Reference</a><a class="list-group-item" href="/ss/tools">Tools</a></nav></aside><div class="callout"><a href="/api/"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-api.svg" /><h4>Flexera CMP APIs</h4></div><span>See the API reference documentation for all of our products.</span></div></div></a></div><div class="callout"><a href="../../ca/cloud_comp/ca_getting_started_with_cloud_comparison.html"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-cloud-blue.svg" /><h4>Cloud Comparison</h4></div><span>Compare public clouds based on the features they offer.</span></div></div></a></div><div class="callout"><a target="_blank" href="http://feedback.rightscale.com"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-feedback.svg" /><h4>Feedback</h4></div><span>Get in touch and we’ll get back to you as soon as we can.</span></div></div></a></div><div class="callout"><a href="/release-notes"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../img/icon-notes.svg" /><h4>Release Notes</h4></div><span>See the notes for the latest releases of each application and what’s changed.</span></div></div></a></div></div></div><div class="col-sm-9"><div class="row"><div class="col-sm-9"><div class="clearfix"><div class="page-header"><h1>Dynamic Parameters - LABS</h1></div><div class="main-content"><div class="alert alert-warning" role="alert"><strong>Note</strong><p>The features described on this page are currently in Labs. This feature should only be used with CAT version <code>20161221</code> or higher.</p>
</div>

<h2 id="overview">Overview</h2>

<p>When launching a CloudApp, you might have a need for parameters whose values changed based on other factors. The two primary types of dynamic parameters that are supported today are:</p>

<ul>
<li><strong>Dependent Parameters</strong> - Use cases where the values of one parameter depend on the value of another parameter. For example being able to first select the Cloud, and only then be able to select the available Regions for that Cloud.</li>
<li><strong>Dynamic Values</strong> - Use cases where the possible values of a dropdown parameter are populated dynamically when the form is launched via some kind of logic (usually involving API calls, sometimes to RightScale and sometimes to other systems). For example having a dropdown that shows the available software builds from Jenkins</li>
</ul>

<h2 id="labs-limitations">Labs Limitations</h2>

<p>The following are known limitations while this feature is in Labs. There may be additional limitations that are not listed here:</p>

<ul>
<li>There is very little error handling, therefore CAT designers must ensure they are meeting the interface requirements and their code is robust</li>
<li>While in Labs, the implementation requires using an escaped JSON-encoded hash in the CAT -- this approach is not intuitive and will not be the final design</li>
<li>When using Cloud Workflow to get values, the CWF process will run in the context of the user launching the CloudApp (if they don&#39;t have roles in Cloud Management, calls to CM will not work)</li>
</ul>

<h2 id="details">Details</h2>

<h3 id="details-dependent-parameters">Dependent Parameters</h3>

<p>Although there may be other requirements for dependent parameters in some cases, the current solution only solves the simple case in which one parameter (the <strong>dependent</strong> parameter) must derive its available values from the value of another parameter (the <strong>lookup</strong> parameter). </p>

<p>The approach is to define a <code>mapping</code> in the CAT which contains the valid values for the dependent parameter based on the value of the lookup parameter. The mapping has the syntax:</p>
<pre class="syntax-highlight ruby"><code><span class="n">mapping</span> <span class="o">&lt;</span><span class="n">mapping_name</span><span class="o">&gt;</span> <span class="k">do</span> <span class="p">{</span>
  <span class="o">&lt;</span><span class="n">key</span> <span class="nb">name</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="o">&lt;</span><span class="n">lookup</span> <span class="n">parameter</span> <span class="n">value</span> <span class="mi">1</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="n">array</span> <span class="n">of</span> <span class="n">possible</span> <span class="n">values</span> <span class="k">for</span> <span class="n">dependent</span> <span class="n">parameter</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="o">&lt;</span><span class="n">lookup</span> <span class="n">parameter</span> <span class="n">value</span> <span class="mi">2</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="n">array</span> <span class="n">of</span> <span class="n">possible</span> <span class="n">values</span> <span class="k">for</span> <span class="n">dependent</span> <span class="n">parameter</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="o">&lt;</span><span class="n">lookup</span> <span class="n">parameter</span> <span class="n">value</span> <span class="mi">3</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="n">array</span> <span class="n">of</span> <span class="n">possible</span> <span class="n">values</span> <span class="k">for</span> <span class="n">dependent</span> <span class="n">parameter</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>The dependent parameter will need to know which mapping to use, the name of the key, and the name of the lookup parameter. This information is specified in the <code>description</code> field of the dependent parameter as an escapted JSON-encoded hash. The hash must contain the following keys:</p>

<ul>
<li><code>mapping</code> - the name of the <code>mapping</code> in the CAT to use for the lookup</li>
<li><code>key</code> - the name of the first-level key to use in the mapping</li>
<li><code>parameter</code> - the name of the parameter this parameter depends on</li>
<li><code>description</code> (optional) - the description to use for this parameter</li>
</ul>

<p>The above parameters are supplied in JSON string which is set as the <code>description</code> attribute of the <code>parameter</code> declaration, prepended with the string <code>json:</code></p>

<p>The designer must take care to avoid circular dependencies.</p>

<h4 id="example">Example</h4>

<p>The below example contains a couple of dependent parameters. The <q>region</q> depends on the <q>cloud</q>, and the <q>network</q> depends on the <q>region</q>.</p>
<pre class="syntax-highlight ruby"><code><span class="nb">name</span> <span class="s2">"Dynamic Parameters example"</span>
<span class="n">rs_ca_ver</span> <span class="mi">20161221</span>
<span class="n">short_description</span> <span class="s2">"Blank"</span>

<span class="n">mapping</span> <span class="s2">"region_values"</span> <span class="k">do</span> <span class="p">{</span>
  <span class="s2">"cloud"</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="s2">"AWS"</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"us-east"</span><span class="p">,</span> <span class="s2">"us-west"</span><span class="p">],</span>
    <span class="s2">"Azure"</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"us west"</span><span class="p">,</span> <span class="s2">"us central"</span><span class="p">,</span> <span class="s2">"us east"</span><span class="p">]</span>
  <span class="p">},</span>
  <span class="s2">"network"</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="s2">"us-east"</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"east net 1"</span><span class="p">,</span> <span class="s2">"east net 2"</span><span class="p">],</span>
    <span class="s2">"us-west"</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"west net 1"</span><span class="p">],</span>
    <span class="s2">"us west"</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"az west 1"</span><span class="p">],</span>
    <span class="s2">"us central"</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"central 1"</span><span class="p">],</span>
    <span class="s2">"us east"</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"east 1"</span><span class="p">,</span> <span class="s2">"east 2"</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="k">end</span>

<span class="n">parameter</span> <span class="s2">"cloud"</span> <span class="k">do</span>
  <span class="n">type</span> <span class="s2">"string"</span>
  <span class="n">label</span> <span class="s2">"Cloud to launch in"</span>
  <span class="n">allowed_values</span> <span class="s2">"AWS"</span><span class="p">,</span> <span class="s2">"Azure"</span>
  <span class="n">operations</span> <span class="s2">"launch"</span> 
<span class="k">end</span>

<span class="n">parameter</span> <span class="s2">"region"</span> <span class="k">do</span>
  <span class="n">type</span> <span class="s2">"string"</span>
  <span class="n">label</span> <span class="s2">"Region to launch in"</span>
  <span class="n">description</span> <span class="s2">"json:{</span><span class="se">\"</span><span class="s2">mapping</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">region_values</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">key</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">cloud</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">parameter</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">cloud</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">description</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">Pick the region - must choose Cloud first</span><span class="se">\"</span><span class="s2">}"</span>
  <span class="n">operations</span> <span class="s2">"launch"</span>
<span class="k">end</span>

<span class="n">parameter</span> <span class="s2">"network"</span> <span class="k">do</span>
  <span class="n">type</span> <span class="s2">"string"</span>
  <span class="n">label</span> <span class="s2">"Network to use"</span>
  <span class="n">description</span> <span class="s2">"json:{</span><span class="se">\"</span><span class="s2">mapping</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">region_values</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">key</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">network</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">parameter</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">region</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">description</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">Pick the network - must choose Region first</span><span class="se">\"</span><span class="s2">}"</span>
  <span class="n">operations</span> <span class="s2">"launch"</span>
<span class="k">end</span>
</code></pre>

<h3 id="details-dynamic-parameter-values">Dynamic Parameter Values</h3>

<p>In some cases, you might want to populate the available values of a dropdown based on some external input (not hard-coded in the CAT). In this case, you can use Cloud Workflow to launch a process that can run arbitrary code, including calling out to external APIs. The dynamically-populated parameter will need to know which RCL definition to use to get the valid values. This information is specified in the <code>description</code> field of the dependent parameter as an escapted JSON-encoded hash. The hash must contain the following keys:</p>

<ul>
<li><code>definition</code> - the name of the <code>definition</code> in the CAT to call to get the values</li>
<li><code>description</code> (optional) - the description to use for this parameter</li>
</ul>

<p>The above parameters are supplied in JSON string which is set as the <code>description</code> attribute of the <code>parameter</code> declaration, prepended with the string <code>json:</code></p>

<p>The designer must ensure that the definition being called meets these requirements:</p>

<ul>
<li>the RCL definition specified must exist in the CAT file</li>
<li>the RCL definition must take no inputs </li>
<li>the RCL definition must return an array of strings</li>
</ul>

<p>Additionally, when using this feature, the designer should concern themselves with the following items:</p>

<ul>
<li>do not use a definition that will take a long time to run (the user will be waiting)</li>
<li>do not use more than 3 of this type of parameter in one CAT (it will affect performance)</li>
<li>the CWF process will run in the context of the launching user (especially important if making CM API 1.5 calls)</li>
<li>the definition should always return an array of strings, otherwise the UI may <q>hang</q> and prevent launching of the CloudApp</li>
</ul>

<p>While the Cloud Workflow is running, the parameter will be disabled. Once the Cloud Workflow completes, the parameter will be re-enabled with the strings returned as the allowed values, or, if the Cloud Workflow fails, an error message will be provided to the user and they will be unable to launch the CloudApp. The error message includes the Cloud Workflow process ID that can be used by a designer in CWF Console to debug the error.</p>

<p>The version to use to make the call to Cloud Workflow will be inferred from the version of the CAT automatically.</p>

<h4 id="example">Example</h4>

<p>The below example contains 2 parameters that contain dynamic values. The first makes a <code>GET</code> http call to github to obtain a list of branches to show to the user. The second calls the <a href="http://reference.rightscale.com/api1.5/index.html">RightScale CM API 1.5</a> to get a list of subnets for a given cloud – this call assumes the user launching is authorized to make such a call (i.e. they must have <code>actor</code> privileges on the given account in RightScale).</p>
<pre class="syntax-highlight ruby"><code><span class="nb">name</span> <span class="s2">"Dynamic Parameters example"</span>
<span class="n">rs_ca_ver</span> <span class="mi">20161221</span>
<span class="n">short_description</span> <span class="s2">"Blank"</span>

<span class="n">parameter</span> <span class="s2">"my_param"</span> <span class="k">do</span>
  <span class="n">label</span> <span class="s2">"Dynamic param"</span>
  <span class="n">type</span> <span class="s2">"string"</span>
  <span class="n">description</span> <span class="s2">"json:{</span><span class="se">\"</span><span class="s2">definition</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">getParamValues</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">description</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">List the branches available (from github.com/rightscale/rightlink_scripts)</span><span class="se">\"</span><span class="s2">}"</span>
<span class="k">end</span>

<span class="n">parameter</span> <span class="s2">"subnet"</span> <span class="k">do</span>
  <span class="n">label</span> <span class="s2">"Subnet"</span>
  <span class="n">type</span> <span class="s2">"string"</span>
  <span class="n">description</span> <span class="s2">"json:{</span><span class="se">\"</span><span class="s2">definition</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">getSubnets</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">description</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">Pick the subnets in AWS US-Oregon</span><span class="se">\"</span><span class="s2">}"</span>
  <span class="n">operations</span> <span class="s2">"launch"</span>
<span class="k">end</span>

<span class="n">define</span> <span class="n">getParamValues</span><span class="p">()</span> <span class="k">return</span> <span class="vg">$values</span> <span class="k">do</span>
  <span class="vg">$resp</span> <span class="o">=</span> <span class="n">http_get</span><span class="p">(</span><span class="ss">url: </span><span class="s2">"https://api.github.com/repos/rightscale/rightlink_scripts/branches"</span><span class="p">)</span>
  <span class="vg">$branches</span> <span class="o">=</span> <span class="vg">$resp</span><span class="p">[</span><span class="s2">"body"</span><span class="p">]</span>
  <span class="vg">$values</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">foreach</span> <span class="vg">$branch</span> <span class="k">in</span> <span class="vg">$branches</span> <span class="k">do</span>
    <span class="vg">$values</span> <span class="o">&lt;&lt;</span> <span class="vg">$branch</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">define</span> <span class="n">getSubnets</span><span class="p">()</span> <span class="k">return</span> <span class="vg">$values</span> <span class="k">do</span>
  <span class="vi">@subnets</span> <span class="o">=</span> <span class="n">rs_cm</span><span class="p">.</span><span class="nf">clouds</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">href</span><span class="ss">:"/api/clouds/6"</span><span class="p">).</span><span class="nf">subnets</span><span class="p">()</span>
  <span class="vg">$values</span> <span class="o">=</span> <span class="vi">@subnets</span><span class="p">.</span><span class="nf">name</span><span class="p">[]</span>
<span class="k">end</span>
</code></pre>
</div></div></div><div class="col-sm-3 hidden-xs affix-parent"><div class="clearfix" data-clampedwidth=".affix-parent" data-offset-bottom="200" data-offset-top="4" data-spy="affix"><nav class="subnav-right" id="subnav-right" role="sub-nav"><script>createRightHandNav();</script></nav></div></div></div></div></div></div></div><footer class="main-footer" role="contentinfo"><div class="container-fluid max-width"><div class="row"><div class="col-sm-10"><ul class="list-inline"><li><small>&copy; 2024 Flexera</small></li><li><a href="http://www.flexera.com/" target="_blank"><small>Flexera Home</small></a></li><li><a href="https://www.flexera.com/about-us/careers.html" target="_blank"><small>We're Hiring</small></a></li></ul></div></div></div></footer><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-KB9SMN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-KB9SMN');</script><script type="text/javascript">
  // Add clipboard button trigger
  var snippets = document.querySelectorAll('.syntax-highlight');
  [].forEach.call(snippets, function(snippet) {
  snippet.firstChild.insertAdjacentHTML('beforebegin', '<button class="btn snippet-clipboard" data-clipboard-snippet><img src="/img/icon-clipboard.svg"></button>');
  });

  // clipboard trigger
  var clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
  target: function(trigger) {
  return trigger.nextElementSibling;
  }
  });

  // Tooltip trigger
  clipboardSnippets.on('success', function(e) {
  e.clearSelection();
  showTooltip(e.trigger, 'Copied!');
  });

  // Error message
  clipboardSnippets.on('error', function(e) {
  showTooltip(e.trigger, fallbackMessage(e.action));
  });

  // Tooltip events
  var btns = document.querySelectorAll('.syntax-highlight .btn');
  for (var i = 0; i < btns.length; i++) {
  btns[i].addEventListener('mouseleave', clearTooltip);
  btns[i].addEventListener('blur', clearTooltip);
  }

  function clearTooltip(e) {
  e.currentTarget.setAttribute('class', 'btn');
  e.currentTarget.removeAttribute('aria-label');
  }

  function showTooltip(elem, msg) {
  elem.setAttribute('class', 'btn tooltipped tooltipped-s');
  elem.setAttribute('aria-label', msg);
  }
</script></body></html>