<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>Policy Lifecycle</title><meta content="The entire lifecycle of a RightScale policy, from start to finish." name="description" /><meta content="initial-scale=1" name="viewport" /><link href="https://my.rightscale.com/favicon.ico" rel="icon" /><!--Stylesheets--><link href="../../../css/main.css" rel="stylesheet" /><!--JavaScript--><script src="../../../js/main.js"></script></head><body class="policies policies_developers policies_developers_concepts policies_developers_concepts_policy_lifecycle" data-spy="scroll" data-target="#subnav-right"><nav class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container-fluid max-width"><div class="navbar-header"><button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="../../../img/FX_Logo_pos.png" /></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a target="_blank" href="https://community.flexera.com/t5/Flexera-Community/ct-p/Flexera_Community">Community</a></li><li><a target="_blank" href="https://www.flexera.com/blog/">Blog</a></li><li><a target="_blank" href="https://www.flexera.com/about-us/contact-us.html">Contact</a></li><li><a target="_blank" href="https://login.rightscale.com/login/session/new">Log In</a></li></ul><ul class="nav navbar-nav navbar-right nav-status"><li class="nav-al-search"><a href="../../../search.html">Search</a></li></ul><form class="navbar-form navbar-left" role="search" action="/search.html" method="get" ><div class="form-group"><input class="form-control input-sm" id="site-search" placeholder="Search" type="text" name="q" /></div><input type="submit" style="position: absolute; left: -9999px"/></form><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript"> docsearch({apiKey: 'b58c3ad6ab9d6e3cd425867d64a6766f',indexName: 'rightscale',inputSelector: '#site-search', debug: false, autocompleteOptions: {autoselect: false}});</script></div></div></nav><div class="wrap"><div class="container-fluid max-width"><div class="row"><div class="col-sm-3"><div class="clearfix"><aside class="main-nav" role="complementary"><nav class="list-group" role="navigations"><a class="list-group-item" href="/policies/"><h4 class="list-group-heading"><img src="../../../img/product-governance.svg" /><span>Policies Users Guide</span></h4></a><a class="list-group-item" href="/policies/">About</a><a class="list-group-item" href="/policies/users/getting_started">Getting Started</a><a class="list-group-item" href="/policies/users/guides">Guides</a><a class="list-group-item" href="../../users/policy_list.html">Flexera Policies</a><a class="list-group-item" href="/policies/users/faq">FAQ</a></nav></aside><aside class="main-nav" role="complementary"><nav class="list-group" role="navigations"><a class="list-group-item" href="/policies/developers"><h4 class="list-group-heading"><img src="../../../img/product-governance.svg" /><span>Policies Developers Guide</span></h4></a><a class="list-group-item" href="/policies/developers">Overview</a></nav></aside><div class="callout"><a href="/api/"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../img/icon-api.svg" /><h4>Flexera CMP APIs</h4></div><span>See the API reference documentation for all of our products.</span></div></div></a></div><div class="callout"><a href="../../../ca/cloud_comp/ca_getting_started_with_cloud_comparison.html"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../img/icon-cloud-blue.svg" /><h4>Cloud Comparison</h4></div><span>Compare public clouds based on the features they offer.</span></div></div></a></div><div class="callout"><a target="_blank" href="http://feedback.rightscale.com"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../img/icon-feedback.svg" /><h4>Feedback</h4></div><span>Get in touch and we’ll get back to you as soon as we can.</span></div></div></a></div><div class="callout"><a href="/release-notes"><div class="panel panel-default"><div class="panel-body"><div class="callout-title"><img src="../../../img/icon-notes.svg" /><h4>Release Notes</h4></div><span>See the notes for the latest releases of each application and what’s changed.</span></div></div></a></div></div></div><div class="col-sm-9"><div class="row"><div class="col-sm-9"><div class="clearfix"><p><a href="../../../">Flexera CMP Docs</a> &#x2F; <a href="../../">Policy Automation</a> &#x2F; <a href="../">Developers Guide</a> &#x2F; <a href="./">Developers Guide</a></p><div class="page-header"><h1>Policy Lifecycle</h1></div><div class="main-content"><h2 id="overview">Overview</h2>

<p>For an overview of basic policy concepts, please read <a href="/policies/#policy-engine-in-a-nutshell">policy engine in a nutshell</a>. This document will delve further into what happens when a policy is applied in a given account.</p>

<p>An <q>applied policy</q> represents policy template code that is evaluated on a fixed schedule that is configured by the user applying the policy. The schedule can range from  15 minutes to monthly depending on the needs and requirements of the policy and will run on that schedule until terminated by a user.</p>

<p>Each evaluation of a given policy is stateless -- all data needed must be fetched every iteration and processed as needed.</p>

<p>Each applied policy runs in the context of a single RightScale account. The policy UI allows for applying a policy across multiple accounts, in which case an applied policy is created in each account selected.</p>

<h2 id="evaluation">Evaluation</h2>

<p>Policy evaluation consists of a series of steps:</p>

<ul>
<li>permissions check</li>
<li>data retrieval and transformation</li>
<li>validation</li>
<li>incident handling</li>
</ul>

<h3 id="evaluation-permissions-check">Permissions Check</h3>

<p>Permissions are checked if an optional <a href="/policies/reference/policy_template_language.html#permissions"><code>permissions</code> block</a>` is supplied. If the user doesn&#39;t have sufficient permissions to take the actions specified, the policy is not applied. These permission checks are currently limited to user roles and actions within the CMP platform.</p>

<h3 id="evaluation-data-retrieval-and-transformation">Data retrieval and transformation</h3>

<p>Data retrieval is accomplished using the <a href="/policies/reference/v20180301/policy_template_language.html#retrieving-data-api-data-with-datasources">datasource</a> and <a href="/policies/reference/v20180301/policy_template_language.html#retrieving-data-listing-resources">resource</a> references. A policy can have any number of such references, each of which will typically correspond to a single API request to RightScale or an external API. </p>

<p>If a policy needs to act on data from multiple API calls, datasources may be <a href="/policies/reference/policy_template_language.html#chaining-datasources">chained together</a> to have one feed into another. The <a href="/policies/getting_started/custom_policy.html#policy-debug-log">debug log</a> will list API requests as they happen as well as a snippet of the data downloaded.</p>

<h3 id="evaluation-validation">Validation</h3>

<p>Once all data has been gathered, the validations defined in the <a href="/policies/reference/policy_template_language.html#policy"><code>policy</code> block</a> are evaluated. Validations consist of a series of checks on the data. Any items failing those checks are gathered together as violation data. Each <code>validate</code> and <code>validate_each</code> statement occurs independently of the others and can produce 1 <q>incident</q>. Multiple <code>validate</code> statements can therefore produce multiple incidents. A <code>validate</code> or <code>validate_each</code> statement may have multiple <code>check</code> statements. The first failed <code>check</code> will result in that data being added as a violation.</p>

<p>If all checks pass and there is no violation data, then one of two things can happen. If no incident exists, nothing will happen and no incident will be generated. If an incident currently exists in a <code>triggered</code> state, it will proceed to a <code>resolved</code> state and any <code>resolution</code> actions defined will be run.</p>

<p>If there is violation data, that data is acted on by any <code>escalate</code> actions defined on the policy.</p>

<h3 id="evaluation-incident-actions">Incident Actions</h3>

<p>In the case where a violation is detected and an incident already exists, the system evaluates the whole of the violation information to determine if any piece of data in the violation has changed, and if so then the incident actions defined in the <code>escalation</code> section will be run. This means that if an existing incident is updated with new violation data, the escalation actions such as <code>email</code>, <code>run</code>, or <code>request_approval</code> will be run again <strong>as if it were created for the first time</strong>. Actions can be run manually on some or all items in violation with <a href="/policies/users/getting_started/index.html#run-action"><code>run_action</code></a>.</p>

<p>Escalations will proceed until they come to a stopping point. This is a either a manual action such an <code>approval_request</code>, an error, or because all actions have finished. If multiple <code>escalate</code> fields are given, they will be evaluated in parallel and the status of each one gathered separately. The incident will continue to exist in a <code>triggered</code> state until the underlying conditions which triggered it change.</p>

<h2 id="termination">Termination</h2>

<p>When an applied policy is terminated, any incidents are immediately moved to a <code>terminated</code> state. Any cloud workflow actions defined in <code>run</code> statements will run to completion unless manually aborted in the <a href="/policies/getting_started/custom_policy.html#escalation-and-resolution-actions">CWF console</a>. No additional escalation or resolution actions will be taken.</p>
</div></div></div><div class="col-sm-3 hidden-xs affix-parent"><div class="clearfix" data-clampedwidth=".affix-parent" data-offset-bottom="200" data-offset-top="4" data-spy="affix"><nav class="subnav-right" id="subnav-right" role="sub-nav"><script>createRightHandNav();</script></nav></div></div></div></div></div></div></div><footer class="main-footer" role="contentinfo"><div class="container-fluid max-width"><div class="row"><div class="col-sm-10"><ul class="list-inline"><li><small>&copy; 2024 Flexera</small></li><li><a href="http://www.flexera.com/" target="_blank"><small>Flexera Home</small></a></li><li><a href="https://www.flexera.com/about-us/careers.html" target="_blank"><small>We're Hiring</small></a></li></ul></div></div></div></footer><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-KB9SMN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-KB9SMN');</script><script type="text/javascript">
  // Add clipboard button trigger
  var snippets = document.querySelectorAll('.syntax-highlight');
  [].forEach.call(snippets, function(snippet) {
  snippet.firstChild.insertAdjacentHTML('beforebegin', '<button class="btn snippet-clipboard" data-clipboard-snippet><img src="/img/icon-clipboard.svg"></button>');
  });

  // clipboard trigger
  var clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
  target: function(trigger) {
  return trigger.nextElementSibling;
  }
  });

  // Tooltip trigger
  clipboardSnippets.on('success', function(e) {
  e.clearSelection();
  showTooltip(e.trigger, 'Copied!');
  });

  // Error message
  clipboardSnippets.on('error', function(e) {
  showTooltip(e.trigger, fallbackMessage(e.action));
  });

  // Tooltip events
  var btns = document.querySelectorAll('.syntax-highlight .btn');
  for (var i = 0; i < btns.length; i++) {
  btns[i].addEventListener('mouseleave', clearTooltip);
  btns[i].addEventListener('blur', clearTooltip);
  }

  function clearTooltip(e) {
  e.currentTarget.setAttribute('class', 'btn');
  e.currentTarget.removeAttribute('aria-label');
  }

  function showTooltip(elem, msg) {
  elem.setAttribute('class', 'btn tooltipped tooltipped-s');
  elem.setAttribute('aria-label', msg);
  }
</script></body></html>